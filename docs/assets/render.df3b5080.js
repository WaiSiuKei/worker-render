var $n=Object.defineProperty;var Vn=(W,B,z)=>B in W?$n(W,B,{enumerable:!0,configurable:!0,writable:!0,value:z}):W[B]=z;var l=(W,B,z)=>(Vn(W,typeof B!="symbol"?B+"":B,z),z);(function(){var nn;"use strict";function W(e){const n=this;let t=!1,i;return function(){return t||(t=!0,i=e.apply(n,arguments)),i}}var B;(e=>{function n(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}e.is=n;const t=Object.freeze([]);function i(){return t}e.empty=i;function*s(b){yield b}e.single=s;function o(b){return b||t}e.from=o;function r(b){return!b||b[Symbol.iterator]().next().done===!0}e.isEmpty=r;function u(b){return b[Symbol.iterator]().next().value}e.first=u;function m(b,T){for(const A of b)if(T(A))return!0;return!1}e.some=m;function g(b,T){for(const A of b)if(T(A))return A}e.find=g;function*_(b,T){for(const A of b)T(A)&&(yield A)}e.filter=_;function*c(b,T){let A=0;for(const F of b)yield T(F,A++)}e.map=c;function*a(...b){for(const T of b)for(const A of T)yield A}e.concat=a;function*v(b){for(const T of b)for(const A of T)yield A}e.concatNested=v;function y(b,T,A){let F=A;for(const R of b)F=T(F,R);return F}e.reduce=y;function*D(b,T,A=b.length){for(T<0&&(T+=b.length),A<0?A+=b.length:A>b.length&&(A=b.length);T<A;T++)yield b[T]}e.slice=D;function M(b,T=Number.POSITIVE_INFINITY){const A=[];if(T===0)return[A,b];const F=b[Symbol.iterator]();for(let R=0;R<T;R++){const f=F.next();if(f.done)return[A,e.empty()];A.push(f.value)}return[A,{[Symbol.iterator](){return F}}]}e.consume=M;function O(b,T,A=(F,R)=>F===R){const F=b[Symbol.iterator](),R=T[Symbol.iterator]();for(;;){const f=F.next(),E=R.next();if(f.done!==E.done)return!1;if(f.done)return!0;if(!A(f.value,E.value))return!1}}e.equals=O})(B||(B={}));function z(e){return typeof e>"u"}const Se=e=>typeof e=="function";function tn(e){return z(e)||e===null}let H=null;function se(e){return H==null||H.trackDisposable(e),e}function oe(e){H==null||H.markAsDisposed(e)}function Fe(e,n){H==null||H.setParent(e,n)}class sn extends Error{constructor(n){super(`Encountered errors while disposing of store. Errors: [${n.join(", ")}]`),this.errors=n}}function _e(e){if(B.is(e)){const n=[];for(const t of e)if(t)try{t.dispose()}catch(i){n.push(i)}if(n.length===1)throw n[0];if(n.length>1)throw new sn(n);return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function Ne(...e){return ne(()=>_e(e))}function ne(e){const n=se({dispose:W(()=>{oe(n),e()})});return n}const Oe=class{constructor(){l(this,"_toDispose",new Set);l(this,"_isDisposed",!1);se(this)}dispose(){this._isDisposed||(oe(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){try{_e(this._toDispose.values())}finally{this._toDispose.clear()}}add(n){if(!n)return n;if(n===this)throw new Error("Cannot register a disposable on itself!");return Fe(n,this),this._isDisposed?Oe.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(n),n}};let x=Oe;l(x,"DISABLE_DISPOSED_WARNING",!1);class le{constructor(){l(this,"$$disposed",!1);l(this,"_store",new x);se(this),Fe(this._store,this)}dispose(){this.$$disposed=!0,oe(this),this._store.dispose()}_register(n){if(n===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(n)}}l(le,"None",Object.freeze({dispose(){}}));class on{constructor(){l(this,"dispose",()=>{});l(this,"unset",()=>{});l(this,"isset",()=>!1);se(this)}set(n){let t=n;return this.unset=()=>t=void 0,this.isset=()=>t!==void 0,this.dispose=()=>{t&&(t(),t=void 0,oe(this))},this}}const ie=class{constructor(n){l(this,"element");l(this,"next");l(this,"prev");this.element=n,this.next=ie.Undefined,this.prev=ie.Undefined}};let d=ie;l(d,"Undefined",new ie(void 0));class be{constructor(){l(this,"_first",d.Undefined);l(this,"_last",d.Undefined);l(this,"_size",0)}get size(){return this._size}isEmpty(){return this._first===d.Undefined}clear(){this._first=d.Undefined,this._last=d.Undefined,this._size=0}unshift(n){return this._insert(n,!1)}push(n){return this._insert(n,!0)}_insert(n,t){const i=new d(n);if(this._first===d.Undefined)this._first=i,this._last=i;else if(t){const o=this._last;this._last=i,i.prev=o,o.next=i}else{const o=this._first;this._first=i,i.next=o,o.prev=i}this._size+=1;let s=!1;return()=>{s||(s=!0,this._remove(i))}}shift(){if(this._first!==d.Undefined){const n=this._first.element;return this._remove(this._first),n}}pop(){if(this._last!==d.Undefined){const n=this._last.element;return this._remove(this._last),n}}_remove(n){if(n.prev!==d.Undefined&&n.next!==d.Undefined){const t=n.prev;t.next=n.next,n.next.prev=t}else n.prev===d.Undefined&&n.next===d.Undefined?(this._first=d.Undefined,this._last=d.Undefined):n.next===d.Undefined?(this._last=this._last.prev,this._last.next=d.Undefined):n.prev===d.Undefined&&(this._first=this._first.next,this._first.prev=d.Undefined);this._size-=1}*[Symbol.iterator](){let n=this._first;for(;n!==d.Undefined;)yield n.element,n=n.next}}class _n{constructor(){l(this,"unexpectedErrorHandler");l(this,"listeners");this.listeners=[],this.unexpectedErrorHandler=function(n){setTimeout(()=>{throw n.stack?new Error(n.message+`

`+n.stack):n},0)}}addListener(n){return this.listeners.push(n),()=>{this._removeListener(n)}}emit(n){this.listeners.forEach(t=>{t(n)})}_removeListener(n){this.listeners.splice(this.listeners.indexOf(n),1)}setUnexpectedErrorHandler(n){this.unexpectedErrorHandler=n}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(n){this.unexpectedErrorHandler(n),this.emit(n)}onUnexpectedExternalError(n){this.unexpectedErrorHandler(n)}}const ln=new _n;function rn(e){cn(e)||ln.onUnexpectedError(e)}const Ue="Canceled";function cn(e){return e instanceof $?!0:e instanceof Error&&e.name===Ue&&e.message===Ue}class $ extends Error{constructor(){super(Ue),this.name=this.message}}const re="en";let ve=!1,ke=!1,ce,ue=re,un,q;const P=typeof self=="object"?self:typeof global=="object"?global:{};let w;typeof P.vscode<"u"&&typeof P.vscode.process<"u"?w=P.vscode.process:typeof process<"u"&&(w=process);const Be=typeof((nn=w==null?void 0:w.versions)==null?void 0:nn.electron)=="string"&&(w==null?void 0:w.type)==="renderer";if(Be&&(w==null||w.sandboxed),typeof navigator=="object"&&!Be)q=navigator.userAgent,q.indexOf("Windows")>=0,q.indexOf("Macintosh")>=0,(q.indexOf("Macintosh")>=0||q.indexOf("iPad")>=0||q.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,ve=q.indexOf("Linux")>=0,ke=!0,ce=navigator.language,ue=ce;else if(typeof w=="object"){w.platform,w.platform,ve=w.platform==="linux",ve&&!!w.env.SNAP&&w.env.SNAP_REVISION,w.env.CI||w.env.BUILD_ARTIFACTSTAGINGDIRECTORY,ce=re,ue=re;const e=w.env.VSCODE_NLS_CONFIG;if(e)try{const n=JSON.parse(e),t=n.availableLanguages["*"];ce=n.locale,ue=t||re,un=n._translationsConfigFile}catch{}}else console.error("Unable to resolve platform.");ke&&P.importScripts;const G=q,K=ue;var Pe;(e=>{function n(){return K}e.value=n;function t(){return K.length===2?K==="en":K.length>=3?K[0]==="e"&&K[1]==="n"&&K[2]==="-":!1}e.isDefaultVariant=t;function i(){return K==="en"}e.isDefault=i})(Pe||(Pe={})),(()=>{if(typeof P.postMessage=="function"&&!P.importScripts){const e=[];P.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let i=0,s=e.length;i<s;i++){const o=e[i];if(o.id===t.data.vscodeScheduleAsyncWork){e.splice(i,1),o.callback();return}}});let n=0;return t=>{const i=++n;e.push({id:i,callback:t}),P.postMessage({vscodeScheduleAsyncWork:i},"*")}}return e=>setTimeout(e)})();const an=!!(G&&G.indexOf("Chrome")>=0);G&&G.indexOf("Firefox")>=0,!an&&G&&G.indexOf("Safari")>=0,G&&G.indexOf("Edg/")>=0,G&&G.indexOf("Android")>=0;const fn=P.performance&&typeof P.performance.now=="function";class Ae{constructor(n){l(this,"_highResolution");l(this,"_startTime");l(this,"_stopTime");this._highResolution=fn&&n,this._startTime=this._now(),this._stopTime=-1}static create(n=!0){return new Ae(n)}stop(){this._stopTime=this._now()}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}_now(){return this._highResolution?P.performance.now():Date.now()}}const ye=class{constructor(n){l(this,"_name");l(this,"_stopWatch");l(this,"_listenerCount",0);l(this,"_invocationCount",0);l(this,"_elapsedOverall",0);this._name=`${n}_${ye._idPool++}`}start(n){this._stopWatch=new Ae(!0),this._listenerCount=n}stop(){if(this._stopWatch){const n=this._stopWatch.elapsed();this._elapsedOverall+=n,this._invocationCount+=1,console.info(`did FIRE ${this._name}: elapsed_ms: ${n.toFixed(5)}, listener: ${this._listenerCount} (elapsed_overall: ${this._elapsedOverall.toFixed(2)}, invocations: ${this._invocationCount})`),this._stopWatch=void 0}}};let ae=ye;l(ae,"_idPool",0);let mn=-1;var h;(e=>{e.None=()=>le.None;function n(R,f){return _(R,()=>{},0,void 0,!0,void 0,f)}e.defer=n;function t(R){return(f,E=null,p)=>{let U=!1,L;return L=R(I=>{if(!U)return L?L.dispose():U=!0,f.call(E,I)},null,p),U&&L.dispose(),L}}e.once=t;function i(R,f,E){return g((p,U=null,L)=>R(I=>p.call(U,f(I)),null,L),E)}e.map=i;function s(R,f,E){return g((p,U=null,L)=>R(I=>{f(I),p.call(U,I)},null,L),E)}e.forEach=s;function o(R,f,E){return g((p,U=null,L)=>R(I=>f(I)&&p.call(U,I),null,L),E)}e.filter=o;function r(R){return R}e.signal=r;function u(...R){return(f,E=null,p)=>Ne(...R.map(U=>U(L=>f.call(E,L),null,p)))}e.any=u;function m(R,f,E,p){let U=E;return i(R,L=>(U=f(U,L),U),p)}e.reduce=m;function g(R,f){let E;const p={onWillAddFirstListener(){E=R(U.fire,U)},onDidRemoveLastListener(){E==null||E.dispose()}},U=new N(p);return f==null||f.add(U),U.event}function _(R,f,E=100,p=!1,U=!1,L,I){let k,C,ee,Re=0,X;const qn={leakWarningThreshold:L,onWillAddFirstListener(){k=R(Kn=>{Re++,C=f(C,Kn),p&&!ee&&(pe.fire(C),C=void 0),X=()=>{const zn=C;C=void 0,ee=void 0,(!p||Re>1)&&pe.fire(zn),Re=0},typeof E=="number"?(clearTimeout(ee),ee=setTimeout(X,E)):ee===void 0&&(ee=0,queueMicrotask(X))})},onWillRemoveListener(){U&&Re>0&&(X==null||X())},onDidRemoveLastListener(){X=void 0,k.dispose()}},pe=new N(qn);return I==null||I.add(pe),pe.event}e.debounce=_;function c(R,f=0,E){return e.debounce(R,(p,U)=>p?(p.push(U),p):[U],f,void 0,!0,void 0,E)}e.accumulate=c;function a(R,f=(p,U)=>p===U,E){let p=!0,U;return o(R,L=>{const I=p||!f(L,U);return p=!1,U=L,I},E)}e.latch=a;function v(R,f,E){return[e.filter(R,f,E),e.filter(R,p=>!f(p),E)]}e.split=v;function y(R,f=!1,E=[]){let p=E.slice(),U=R(k=>{p?p.push(k):I.fire(k)});const L=()=>{p==null||p.forEach(k=>I.fire(k)),p=null},I=new N({onWillAddFirstListener(){U||(U=R(k=>I.fire(k)))},onDidAddFirstListener(){p&&(f?setTimeout(L):L())},onDidRemoveLastListener(){U&&U.dispose(),U=null}});return I.event}e.buffer=y;class D{constructor(f){l(this,"disposables",new x);this.event=f}map(f){return new D(i(this.event,f,this.disposables))}forEach(f){return new D(s(this.event,f,this.disposables))}filter(f){return new D(o(this.event,f,this.disposables))}reduce(f,E){return new D(m(this.event,f,E,this.disposables))}latch(){return new D(a(this.event,void 0,this.disposables))}debounce(f,E=100,p=!1,U=!1,L){return new D(_(this.event,f,E,p,U,L,this.disposables))}on(f,E,p){return this.event(f,E,p)}once(f,E,p){return t(this.event)(f,E,p)}dispose(){this.disposables.dispose()}}function M(R){return new D(R)}e.chain=M;function O(R,f,E=p=>p){const p=(...k)=>I.fire(E(...k)),U=()=>R.on(f,p),L=()=>R.removeListener(f,p),I=new N({onWillAddFirstListener:U,onDidRemoveLastListener:L});return I.event}e.fromNodeEventEmitter=O;function b(R,f,E=p=>p){const p=(...k)=>I.fire(E(...k)),U=()=>R.addEventListener(f,p),L=()=>R.removeEventListener(f,p),I=new N({onWillAddFirstListener:U,onDidRemoveLastListener:L});return I.event}e.fromDOMEventEmitter=b;function T(R){return new Promise(f=>t(R)(f))}e.toPromise=T;function A(R,f){return f(void 0),R(E=>f(E))}e.runAndSubscribe=A;function F(R,f){let E=null;function p(L){E==null||E.dispose(),E=new x,f(L,E)}p(void 0);const U=R(L=>p(L));return ne(()=>{U.dispose(),E==null||E.dispose()})}e.runAndSubscribeWithStore=F})(h||(h={}));class gn{constructor(n,t=Math.random().toString(18).slice(2,5)){l(this,"_stacks");l(this,"_warnCountdown",0);this.threshold=n,this.name=t}dispose(){var n;(n=this._stacks)==null||n.clear()}check(n,t){const i=this.threshold;if(i<=0||t<i)return;this._stacks||(this._stacks=new Map);const s=this._stacks.get(n.value)||0;if(this._stacks.set(n.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=i*.5;let o,r=0;for(const[u,m]of this._stacks)(!o||r<m)&&(o=u,r=m);console.warn(`[${this.name}] potential listener LEAK detected, having ${t} listeners already. MOST frequent listener (${r}):`),console.warn(o)}return()=>{const o=this._stacks.get(n.value)||0;this._stacks.set(n.value,o-1)}}}class Le{constructor(n){this.value=n}static create(){var n;return new Le((n=new Error().stack)!=null?n:"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}}class En{constructor(n,t,i){l(this,"subscription",new on);this.callback=n,this.callbackThis=t,this.stack=i}invoke(n){this.callback.call(this.callbackThis,n)}}class N{constructor(n){l(this,"_options");l(this,"_leakageMon");l(this,"_perfMon");l(this,"_disposed",!1);l(this,"_event");l(this,"_deliveryQueue");l(this,"_listeners");var t,i,s,o,r;this._options=n,this._leakageMon=(t=this._options)!=null&&t.leakWarningThreshold?new gn((s=(i=this._options)==null?void 0:i.leakWarningThreshold)!=null?s:mn):void 0,this._perfMon=(o=this._options)!=null&&o._profName?new ae(this._options._profName):void 0,this._deliveryQueue=(r=this._options)==null?void 0:r.deliveryQueue}dispose(){var n,t,i,s;this._disposed||(this._disposed=!0,this._listeners&&this._listeners.clear(),(n=this._deliveryQueue)==null||n.clear(this),(i=(t=this._options)==null?void 0:t.onDidRemoveLastListener)==null||i.call(t),(s=this._leakageMon)==null||s.dispose())}get event(){return this._event||(this._event=(n,t,i)=>{var _,c,a;if(this._listeners||(this._listeners=new be),this._leakageMon&&this._listeners.size>this._leakageMon.threshold*3)return console.warn(`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far`),le.None;const s=this._listeners.isEmpty();s&&((_=this._options)==null?void 0:_.onWillAddFirstListener)&&this._options.onWillAddFirstListener(this);let o,r;this._leakageMon&&this._listeners.size>=Math.ceil(this._leakageMon.threshold*.2)&&(r=Le.create(),o=this._leakageMon.check(r,this._listeners.size+1));const u=new En(n,t,r),m=this._listeners.push(u);s&&((c=this._options)==null?void 0:c.onDidAddFirstListener)&&this._options.onDidAddFirstListener(this),(a=this._options)!=null&&a.onDidAddListener&&this._options.onDidAddListener(this,n,t);const g=u.subscription.set(()=>{var v,y;o==null||o(),this._disposed||((y=(v=this._options)==null?void 0:v.onWillRemoveListener)==null||y.call(v,this),m(),this._options&&this._options.onDidRemoveLastListener&&(this._listeners&&!this._listeners.isEmpty()||this._options.onDidRemoveLastListener(this)))});return i instanceof x?i.add(g):Array.isArray(i)&&i.push(g),g}),this._event}fire(n){var t,i,s;if(this._listeners){this._deliveryQueue||(this._deliveryQueue=new pn((t=this._options)==null?void 0:t.onListenerError));for(const o of this._listeners)this._deliveryQueue.push(this,o,n);(i=this._perfMon)==null||i.start(this._deliveryQueue.size),this._deliveryQueue.deliver(),(s=this._perfMon)==null||s.stop()}}hasListeners(){return this._listeners?!this._listeners.isEmpty():!1}}class Rn{constructor(n=rn){l(this,"_queue",new be);this._onListenerError=n}get size(){return this._queue.size}push(n,t,i){this._queue.push(new bn(n,t,i))}clear(n){const t=new be;for(const i of this._queue)i.emitter!==n&&t.push(i);this._queue=t}deliver(){for(;this._queue.size>0;){const n=this._queue.shift();try{n.listener.invoke(n.event)}catch(t){this._onListenerError(t)}}}}class pn extends Rn{clear(n){this._queue.clear()}}class bn{constructor(n,t,i){this.emitter=n,this.listener=t,this.event=i}}class Un{constructor(){l(this,"emitter");l(this,"hasListeners",!1);l(this,"events",[]);this.emitter=new N({onWillAddFirstListener:()=>this.onFirstListenerAdd(),onDidRemoveLastListener:()=>this.onLastListenerRemove()})}get event(){return this.emitter.event}add(n){const t={event:n,listener:null};return this.events.push(t),this.hasListeners&&this.hook(t),ne(W(()=>{this.hasListeners&&this.unhook(t);const s=this.events.indexOf(t);this.events.splice(s,1)}))}onFirstListenerAdd(){this.hasListeners=!0,this.events.forEach(n=>this.hook(n))}onLastListenerRemove(){this.hasListeners=!1,this.events.forEach(n=>this.unhook(n))}hook(n){n.listener=n.event(t=>this.emitter.fire(t))}unhook(n){n.listener&&n.listener.dispose(),n.listener=null}dispose(){this.emitter.dispose()}}class vn{constructor(){l(this,"listening",!1);l(this,"inputEvent",h.None);l(this,"inputEventListener",le.None);l(this,"emitter",new N({onDidAddFirstListener:()=>{this.listening=!0,this.inputEventListener=this.inputEvent(this.emitter.fire,this.emitter)},onDidRemoveLastListener:()=>{this.listening=!1,this.inputEventListener.dispose()}}));l(this,"event",this.emitter.event)}set input(n){this.inputEvent=n,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=n(this.emitter.fire,this.emitter))}dispose(){this.inputEventListener.dispose(),this.emitter.dispose()}}const Ge=Object.freeze(function(e,n){const t=setTimeout(e.bind(n),0);return{dispose(){clearTimeout(t)}}});var te;(e=>{function n(t){return t===e.None||t===e.Cancelled||t instanceof fe?!0:!t||typeof t!="object"?!1:typeof t.isCancellationRequested=="boolean"&&typeof t.onCancellationRequested=="function"}e.isCancellationToken=n,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:h.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Ge})})(te||(te={}));class fe{constructor(){l(this,"_isCancelled",!1);l(this,"_emitter",null)}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Ge:(this._emitter||(this._emitter=new N),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}class He{constructor(n){l(this,"_token");l(this,"_parentListener");this._parentListener=n&&n.onCancellationRequested(this.cancel,this)}get token(){return this._token||(this._token=new fe),this._token}cancel(){this._token?this._token instanceof fe&&this._token.cancel():this._token=te.Cancelled}dispose(n=!1){n&&this.cancel(),this._parentListener&&this._parentListener.dispose(),this._token?this._token instanceof fe&&this._token.dispose():this._token=te.None}}function xe(e){const n=new He,t=e(n.token),i=new Promise((s,o)=>{const r=n.token.onCancellationRequested(()=>{r.dispose(),n.dispose(),o(new $)});Promise.resolve(t).then(u=>{r.dispose(),n.dispose(),s(u)},u=>{r.dispose(),n.dispose(),o(u)})});return new class{cancel(){n.cancel()}then(s,o){return i.then(s,o)}catch(s){return this.then(void 0,s)}finally(s){return i.finally(s)}}}(function(){(typeof requestIdleCallback!="function"||typeof cancelIdleCallback!="function")&&Object.freeze({didTimeout:!0,timeRemaining(){return 15}})})();class We{constructor(){l(this,"completeCallback");l(this,"errorCallback");l(this,"rejected",!1);l(this,"resolved",!1);l(this,"p");this.p=new Promise((n,t)=>{this.completeCallback=n,this.errorCallback=t})}get isRejected(){return this.rejected}get isResolved(){return this.resolved}get isSettled(){return this.rejected||this.resolved}complete(n){return new Promise(t=>{this.completeCallback(n),this.resolved=!0,t()})}error(n){return new Promise(t=>{this.errorCallback(n),this.rejected=!0,t()})}cancel(){new Promise(n=>{this.errorCallback(new $),this.rejected=!0,n()})}}var qe;(e=>{async function n(i){let s;const o=await Promise.all(i.map(r=>r.then(u=>u,u=>{s||(s=u)})));if(typeof s<"u")throw s;return o}e.settled=n;function t(i){return new Promise(async(s,o)=>{try{await i(s,o)}catch(r){o(r)}})}e.withAsyncBody=t})(qe||(qe={}));function An(e){return e[Math.floor(Math.random()*e.length)]}function Ln(e,n,t){let i=null,s=null;if(typeof t.value=="function"?(i="value",s=t.value,s.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof t.get=="function"&&(i="get",s=t.get),!s)throw new Error("not supported");const o=`$memoize$${n}`;t[i]=function(...r){return this.hasOwnProperty(o)||Object.defineProperty(this,o,{configurable:!1,enumerable:!1,writable:!1,value:s.apply(this,r)}),this[o]}}function Ke(...e){throw e.length&&console.error(...e),new Error("not reached")}function ze(...e){throw e.length&&console.error(...e),new Error("not implemented")}var Te=(e=>(e[e.Null=0]="Null",e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.LineFeed=10]="LineFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.DoubleQuote=34]="DoubleQuote",e[e.Hash=35]="Hash",e[e.DollarSign=36]="DollarSign",e[e.PercentSign=37]="PercentSign",e[e.Ampersand=38]="Ampersand",e[e.SingleQuote=39]="SingleQuote",e[e.OpenParen=40]="OpenParen",e[e.CloseParen=41]="CloseParen",e[e.Asterisk=42]="Asterisk",e[e.Plus=43]="Plus",e[e.Comma=44]="Comma",e[e.Dash=45]="Dash",e[e.Period=46]="Period",e[e.Slash=47]="Slash",e[e.Digit0=48]="Digit0",e[e.Digit1=49]="Digit1",e[e.Digit2=50]="Digit2",e[e.Digit3=51]="Digit3",e[e.Digit4=52]="Digit4",e[e.Digit5=53]="Digit5",e[e.Digit6=54]="Digit6",e[e.Digit7=55]="Digit7",e[e.Digit8=56]="Digit8",e[e.Digit9=57]="Digit9",e[e.Colon=58]="Colon",e[e.Semicolon=59]="Semicolon",e[e.LessThan=60]="LessThan",e[e.Equals=61]="Equals",e[e.GreaterThan=62]="GreaterThan",e[e.QuestionMark=63]="QuestionMark",e[e.AtSign=64]="AtSign",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.OpenSquareBracket=91]="OpenSquareBracket",e[e.Backslash=92]="Backslash",e[e.CloseSquareBracket=93]="CloseSquareBracket",e[e.Caret=94]="Caret",e[e.Underline=95]="Underline",e[e.BackTick=96]="BackTick",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.OpenCurlyBrace=123]="OpenCurlyBrace",e[e.Pipe=124]="Pipe",e[e.CloseCurlyBrace=125]="CloseCurlyBrace",e[e.Tilde=126]="Tilde",e[e.U_Combining_Grave_Accent=768]="U_Combining_Grave_Accent",e[e.U_Combining_Acute_Accent=769]="U_Combining_Acute_Accent",e[e.U_Combining_Circumflex_Accent=770]="U_Combining_Circumflex_Accent",e[e.U_Combining_Tilde=771]="U_Combining_Tilde",e[e.U_Combining_Macron=772]="U_Combining_Macron",e[e.U_Combining_Overline=773]="U_Combining_Overline",e[e.U_Combining_Breve=774]="U_Combining_Breve",e[e.U_Combining_Dot_Above=775]="U_Combining_Dot_Above",e[e.U_Combining_Diaeresis=776]="U_Combining_Diaeresis",e[e.U_Combining_Hook_Above=777]="U_Combining_Hook_Above",e[e.U_Combining_Ring_Above=778]="U_Combining_Ring_Above",e[e.U_Combining_Double_Acute_Accent=779]="U_Combining_Double_Acute_Accent",e[e.U_Combining_Caron=780]="U_Combining_Caron",e[e.U_Combining_Vertical_Line_Above=781]="U_Combining_Vertical_Line_Above",e[e.U_Combining_Double_Vertical_Line_Above=782]="U_Combining_Double_Vertical_Line_Above",e[e.U_Combining_Double_Grave_Accent=783]="U_Combining_Double_Grave_Accent",e[e.U_Combining_Candrabindu=784]="U_Combining_Candrabindu",e[e.U_Combining_Inverted_Breve=785]="U_Combining_Inverted_Breve",e[e.U_Combining_Turned_Comma_Above=786]="U_Combining_Turned_Comma_Above",e[e.U_Combining_Comma_Above=787]="U_Combining_Comma_Above",e[e.U_Combining_Reversed_Comma_Above=788]="U_Combining_Reversed_Comma_Above",e[e.U_Combining_Comma_Above_Right=789]="U_Combining_Comma_Above_Right",e[e.U_Combining_Grave_Accent_Below=790]="U_Combining_Grave_Accent_Below",e[e.U_Combining_Acute_Accent_Below=791]="U_Combining_Acute_Accent_Below",e[e.U_Combining_Left_Tack_Below=792]="U_Combining_Left_Tack_Below",e[e.U_Combining_Right_Tack_Below=793]="U_Combining_Right_Tack_Below",e[e.U_Combining_Left_Angle_Above=794]="U_Combining_Left_Angle_Above",e[e.U_Combining_Horn=795]="U_Combining_Horn",e[e.U_Combining_Left_Half_Ring_Below=796]="U_Combining_Left_Half_Ring_Below",e[e.U_Combining_Up_Tack_Below=797]="U_Combining_Up_Tack_Below",e[e.U_Combining_Down_Tack_Below=798]="U_Combining_Down_Tack_Below",e[e.U_Combining_Plus_Sign_Below=799]="U_Combining_Plus_Sign_Below",e[e.U_Combining_Minus_Sign_Below=800]="U_Combining_Minus_Sign_Below",e[e.U_Combining_Palatalized_Hook_Below=801]="U_Combining_Palatalized_Hook_Below",e[e.U_Combining_Retroflex_Hook_Below=802]="U_Combining_Retroflex_Hook_Below",e[e.U_Combining_Dot_Below=803]="U_Combining_Dot_Below",e[e.U_Combining_Diaeresis_Below=804]="U_Combining_Diaeresis_Below",e[e.U_Combining_Ring_Below=805]="U_Combining_Ring_Below",e[e.U_Combining_Comma_Below=806]="U_Combining_Comma_Below",e[e.U_Combining_Cedilla=807]="U_Combining_Cedilla",e[e.U_Combining_Ogonek=808]="U_Combining_Ogonek",e[e.U_Combining_Vertical_Line_Below=809]="U_Combining_Vertical_Line_Below",e[e.U_Combining_Bridge_Below=810]="U_Combining_Bridge_Below",e[e.U_Combining_Inverted_Double_Arch_Below=811]="U_Combining_Inverted_Double_Arch_Below",e[e.U_Combining_Caron_Below=812]="U_Combining_Caron_Below",e[e.U_Combining_Circumflex_Accent_Below=813]="U_Combining_Circumflex_Accent_Below",e[e.U_Combining_Breve_Below=814]="U_Combining_Breve_Below",e[e.U_Combining_Inverted_Breve_Below=815]="U_Combining_Inverted_Breve_Below",e[e.U_Combining_Tilde_Below=816]="U_Combining_Tilde_Below",e[e.U_Combining_Macron_Below=817]="U_Combining_Macron_Below",e[e.U_Combining_Low_Line=818]="U_Combining_Low_Line",e[e.U_Combining_Double_Low_Line=819]="U_Combining_Double_Low_Line",e[e.U_Combining_Tilde_Overlay=820]="U_Combining_Tilde_Overlay",e[e.U_Combining_Short_Stroke_Overlay=821]="U_Combining_Short_Stroke_Overlay",e[e.U_Combining_Long_Stroke_Overlay=822]="U_Combining_Long_Stroke_Overlay",e[e.U_Combining_Short_Solidus_Overlay=823]="U_Combining_Short_Solidus_Overlay",e[e.U_Combining_Long_Solidus_Overlay=824]="U_Combining_Long_Solidus_Overlay",e[e.U_Combining_Right_Half_Ring_Below=825]="U_Combining_Right_Half_Ring_Below",e[e.U_Combining_Inverted_Bridge_Below=826]="U_Combining_Inverted_Bridge_Below",e[e.U_Combining_Square_Below=827]="U_Combining_Square_Below",e[e.U_Combining_Seagull_Below=828]="U_Combining_Seagull_Below",e[e.U_Combining_X_Above=829]="U_Combining_X_Above",e[e.U_Combining_Vertical_Tilde=830]="U_Combining_Vertical_Tilde",e[e.U_Combining_Double_Overline=831]="U_Combining_Double_Overline",e[e.U_Combining_Grave_Tone_Mark=832]="U_Combining_Grave_Tone_Mark",e[e.U_Combining_Acute_Tone_Mark=833]="U_Combining_Acute_Tone_Mark",e[e.U_Combining_Greek_Perispomeni=834]="U_Combining_Greek_Perispomeni",e[e.U_Combining_Greek_Koronis=835]="U_Combining_Greek_Koronis",e[e.U_Combining_Greek_Dialytika_Tonos=836]="U_Combining_Greek_Dialytika_Tonos",e[e.U_Combining_Greek_Ypogegrammeni=837]="U_Combining_Greek_Ypogegrammeni",e[e.U_Combining_Bridge_Above=838]="U_Combining_Bridge_Above",e[e.U_Combining_Equals_Sign_Below=839]="U_Combining_Equals_Sign_Below",e[e.U_Combining_Double_Vertical_Line_Below=840]="U_Combining_Double_Vertical_Line_Below",e[e.U_Combining_Left_Angle_Below=841]="U_Combining_Left_Angle_Below",e[e.U_Combining_Not_Tilde_Above=842]="U_Combining_Not_Tilde_Above",e[e.U_Combining_Homothetic_Above=843]="U_Combining_Homothetic_Above",e[e.U_Combining_Almost_Equal_To_Above=844]="U_Combining_Almost_Equal_To_Above",e[e.U_Combining_Left_Right_Arrow_Below=845]="U_Combining_Left_Right_Arrow_Below",e[e.U_Combining_Upwards_Arrow_Below=846]="U_Combining_Upwards_Arrow_Below",e[e.U_Combining_Grapheme_Joiner=847]="U_Combining_Grapheme_Joiner",e[e.U_Combining_Right_Arrowhead_Above=848]="U_Combining_Right_Arrowhead_Above",e[e.U_Combining_Left_Half_Ring_Above=849]="U_Combining_Left_Half_Ring_Above",e[e.U_Combining_Fermata=850]="U_Combining_Fermata",e[e.U_Combining_X_Below=851]="U_Combining_X_Below",e[e.U_Combining_Left_Arrowhead_Below=852]="U_Combining_Left_Arrowhead_Below",e[e.U_Combining_Right_Arrowhead_Below=853]="U_Combining_Right_Arrowhead_Below",e[e.U_Combining_Right_Arrowhead_And_Up_Arrowhead_Below=854]="U_Combining_Right_Arrowhead_And_Up_Arrowhead_Below",e[e.U_Combining_Right_Half_Ring_Above=855]="U_Combining_Right_Half_Ring_Above",e[e.U_Combining_Dot_Above_Right=856]="U_Combining_Dot_Above_Right",e[e.U_Combining_Asterisk_Below=857]="U_Combining_Asterisk_Below",e[e.U_Combining_Double_Ring_Below=858]="U_Combining_Double_Ring_Below",e[e.U_Combining_Zigzag_Above=859]="U_Combining_Zigzag_Above",e[e.U_Combining_Double_Breve_Below=860]="U_Combining_Double_Breve_Below",e[e.U_Combining_Double_Breve=861]="U_Combining_Double_Breve",e[e.U_Combining_Double_Macron=862]="U_Combining_Double_Macron",e[e.U_Combining_Double_Macron_Below=863]="U_Combining_Double_Macron_Below",e[e.U_Combining_Double_Tilde=864]="U_Combining_Double_Tilde",e[e.U_Combining_Double_Inverted_Breve=865]="U_Combining_Double_Inverted_Breve",e[e.U_Combining_Double_Rightwards_Arrow_Below=866]="U_Combining_Double_Rightwards_Arrow_Below",e[e.U_Combining_Latin_Small_Letter_A=867]="U_Combining_Latin_Small_Letter_A",e[e.U_Combining_Latin_Small_Letter_E=868]="U_Combining_Latin_Small_Letter_E",e[e.U_Combining_Latin_Small_Letter_I=869]="U_Combining_Latin_Small_Letter_I",e[e.U_Combining_Latin_Small_Letter_O=870]="U_Combining_Latin_Small_Letter_O",e[e.U_Combining_Latin_Small_Letter_U=871]="U_Combining_Latin_Small_Letter_U",e[e.U_Combining_Latin_Small_Letter_C=872]="U_Combining_Latin_Small_Letter_C",e[e.U_Combining_Latin_Small_Letter_D=873]="U_Combining_Latin_Small_Letter_D",e[e.U_Combining_Latin_Small_Letter_H=874]="U_Combining_Latin_Small_Letter_H",e[e.U_Combining_Latin_Small_Letter_M=875]="U_Combining_Latin_Small_Letter_M",e[e.U_Combining_Latin_Small_Letter_R=876]="U_Combining_Latin_Small_Letter_R",e[e.U_Combining_Latin_Small_Letter_T=877]="U_Combining_Latin_Small_Letter_T",e[e.U_Combining_Latin_Small_Letter_V=878]="U_Combining_Latin_Small_Letter_V",e[e.U_Combining_Latin_Small_Letter_X=879]="U_Combining_Latin_Small_Letter_X",e[e.LINE_SEPARATOR=8232]="LINE_SEPARATOR",e[e.PARAGRAPH_SEPARATOR=8233]="PARAGRAPH_SEPARATOR",e[e.NEXT_LINE=133]="NEXT_LINE",e[e.U_CIRCUMFLEX=94]="U_CIRCUMFLEX",e[e.U_GRAVE_ACCENT=96]="U_GRAVE_ACCENT",e[e.U_DIAERESIS=168]="U_DIAERESIS",e[e.U_MACRON=175]="U_MACRON",e[e.U_ACUTE_ACCENT=180]="U_ACUTE_ACCENT",e[e.U_CEDILLA=184]="U_CEDILLA",e[e.U_MODIFIER_LETTER_LEFT_ARROWHEAD=706]="U_MODIFIER_LETTER_LEFT_ARROWHEAD",e[e.U_MODIFIER_LETTER_RIGHT_ARROWHEAD=707]="U_MODIFIER_LETTER_RIGHT_ARROWHEAD",e[e.U_MODIFIER_LETTER_UP_ARROWHEAD=708]="U_MODIFIER_LETTER_UP_ARROWHEAD",e[e.U_MODIFIER_LETTER_DOWN_ARROWHEAD=709]="U_MODIFIER_LETTER_DOWN_ARROWHEAD",e[e.U_MODIFIER_LETTER_CENTRED_RIGHT_HALF_RING=722]="U_MODIFIER_LETTER_CENTRED_RIGHT_HALF_RING",e[e.U_MODIFIER_LETTER_CENTRED_LEFT_HALF_RING=723]="U_MODIFIER_LETTER_CENTRED_LEFT_HALF_RING",e[e.U_MODIFIER_LETTER_UP_TACK=724]="U_MODIFIER_LETTER_UP_TACK",e[e.U_MODIFIER_LETTER_DOWN_TACK=725]="U_MODIFIER_LETTER_DOWN_TACK",e[e.U_MODIFIER_LETTER_PLUS_SIGN=726]="U_MODIFIER_LETTER_PLUS_SIGN",e[e.U_MODIFIER_LETTER_MINUS_SIGN=727]="U_MODIFIER_LETTER_MINUS_SIGN",e[e.U_BREVE=728]="U_BREVE",e[e.U_DOT_ABOVE=729]="U_DOT_ABOVE",e[e.U_RING_ABOVE=730]="U_RING_ABOVE",e[e.U_OGONEK=731]="U_OGONEK",e[e.U_SMALL_TILDE=732]="U_SMALL_TILDE",e[e.U_DOUBLE_ACUTE_ACCENT=733]="U_DOUBLE_ACUTE_ACCENT",e[e.U_MODIFIER_LETTER_RHOTIC_HOOK=734]="U_MODIFIER_LETTER_RHOTIC_HOOK",e[e.U_MODIFIER_LETTER_CROSS_ACCENT=735]="U_MODIFIER_LETTER_CROSS_ACCENT",e[e.U_MODIFIER_LETTER_EXTRA_HIGH_TONE_BAR=741]="U_MODIFIER_LETTER_EXTRA_HIGH_TONE_BAR",e[e.U_MODIFIER_LETTER_HIGH_TONE_BAR=742]="U_MODIFIER_LETTER_HIGH_TONE_BAR",e[e.U_MODIFIER_LETTER_MID_TONE_BAR=743]="U_MODIFIER_LETTER_MID_TONE_BAR",e[e.U_MODIFIER_LETTER_LOW_TONE_BAR=744]="U_MODIFIER_LETTER_LOW_TONE_BAR",e[e.U_MODIFIER_LETTER_EXTRA_LOW_TONE_BAR=745]="U_MODIFIER_LETTER_EXTRA_LOW_TONE_BAR",e[e.U_MODIFIER_LETTER_YIN_DEPARTING_TONE_MARK=746]="U_MODIFIER_LETTER_YIN_DEPARTING_TONE_MARK",e[e.U_MODIFIER_LETTER_YANG_DEPARTING_TONE_MARK=747]="U_MODIFIER_LETTER_YANG_DEPARTING_TONE_MARK",e[e.U_MODIFIER_LETTER_UNASPIRATED=749]="U_MODIFIER_LETTER_UNASPIRATED",e[e.U_MODIFIER_LETTER_LOW_DOWN_ARROWHEAD=751]="U_MODIFIER_LETTER_LOW_DOWN_ARROWHEAD",e[e.U_MODIFIER_LETTER_LOW_UP_ARROWHEAD=752]="U_MODIFIER_LETTER_LOW_UP_ARROWHEAD",e[e.U_MODIFIER_LETTER_LOW_LEFT_ARROWHEAD=753]="U_MODIFIER_LETTER_LOW_LEFT_ARROWHEAD",e[e.U_MODIFIER_LETTER_LOW_RIGHT_ARROWHEAD=754]="U_MODIFIER_LETTER_LOW_RIGHT_ARROWHEAD",e[e.U_MODIFIER_LETTER_LOW_RING=755]="U_MODIFIER_LETTER_LOW_RING",e[e.U_MODIFIER_LETTER_MIDDLE_GRAVE_ACCENT=756]="U_MODIFIER_LETTER_MIDDLE_GRAVE_ACCENT",e[e.U_MODIFIER_LETTER_MIDDLE_DOUBLE_GRAVE_ACCENT=757]="U_MODIFIER_LETTER_MIDDLE_DOUBLE_GRAVE_ACCENT",e[e.U_MODIFIER_LETTER_MIDDLE_DOUBLE_ACUTE_ACCENT=758]="U_MODIFIER_LETTER_MIDDLE_DOUBLE_ACUTE_ACCENT",e[e.U_MODIFIER_LETTER_LOW_TILDE=759]="U_MODIFIER_LETTER_LOW_TILDE",e[e.U_MODIFIER_LETTER_RAISED_COLON=760]="U_MODIFIER_LETTER_RAISED_COLON",e[e.U_MODIFIER_LETTER_BEGIN_HIGH_TONE=761]="U_MODIFIER_LETTER_BEGIN_HIGH_TONE",e[e.U_MODIFIER_LETTER_END_HIGH_TONE=762]="U_MODIFIER_LETTER_END_HIGH_TONE",e[e.U_MODIFIER_LETTER_BEGIN_LOW_TONE=763]="U_MODIFIER_LETTER_BEGIN_LOW_TONE",e[e.U_MODIFIER_LETTER_END_LOW_TONE=764]="U_MODIFIER_LETTER_END_LOW_TONE",e[e.U_MODIFIER_LETTER_SHELF=765]="U_MODIFIER_LETTER_SHELF",e[e.U_MODIFIER_LETTER_OPEN_SHELF=766]="U_MODIFIER_LETTER_OPEN_SHELF",e[e.U_MODIFIER_LETTER_LOW_LEFT_ARROW=767]="U_MODIFIER_LETTER_LOW_LEFT_ARROW",e[e.U_GREEK_LOWER_NUMERAL_SIGN=885]="U_GREEK_LOWER_NUMERAL_SIGN",e[e.U_GREEK_TONOS=900]="U_GREEK_TONOS",e[e.U_GREEK_DIALYTIKA_TONOS=901]="U_GREEK_DIALYTIKA_TONOS",e[e.U_GREEK_KORONIS=8125]="U_GREEK_KORONIS",e[e.U_GREEK_PSILI=8127]="U_GREEK_PSILI",e[e.U_GREEK_PERISPOMENI=8128]="U_GREEK_PERISPOMENI",e[e.U_GREEK_DIALYTIKA_AND_PERISPOMENI=8129]="U_GREEK_DIALYTIKA_AND_PERISPOMENI",e[e.U_GREEK_PSILI_AND_VARIA=8141]="U_GREEK_PSILI_AND_VARIA",e[e.U_GREEK_PSILI_AND_OXIA=8142]="U_GREEK_PSILI_AND_OXIA",e[e.U_GREEK_PSILI_AND_PERISPOMENI=8143]="U_GREEK_PSILI_AND_PERISPOMENI",e[e.U_GREEK_DASIA_AND_VARIA=8157]="U_GREEK_DASIA_AND_VARIA",e[e.U_GREEK_DASIA_AND_OXIA=8158]="U_GREEK_DASIA_AND_OXIA",e[e.U_GREEK_DASIA_AND_PERISPOMENI=8159]="U_GREEK_DASIA_AND_PERISPOMENI",e[e.U_GREEK_DIALYTIKA_AND_VARIA=8173]="U_GREEK_DIALYTIKA_AND_VARIA",e[e.U_GREEK_DIALYTIKA_AND_OXIA=8174]="U_GREEK_DIALYTIKA_AND_OXIA",e[e.U_GREEK_VARIA=8175]="U_GREEK_VARIA",e[e.U_GREEK_OXIA=8189]="U_GREEK_OXIA",e[e.U_GREEK_DASIA=8190]="U_GREEK_DASIA",e[e.U_OVERLINE=8254]="U_OVERLINE",e[e.UTF8_BOM=65279]="UTF8_BOM",e))(Te||{});function $e(e){return e>=Te.A&&e<=Te.Z}var Tn=Object.defineProperty,Dn=Object.getOwnPropertyDescriptor,In=(e,n,t,i)=>{for(var s=i>1?void 0:i?Dn(n,t):n,o=e.length-1,r;o>=0;o--)(r=e[o])&&(s=(i?r(n,t,s):r(s))||s);return i&&s&&Tn(n,t,s),s};function Q(e){switch(e){case 100:return"req";case 101:return"cancel";case 102:return"subscribe";case 103:return"unsubscribe"}}function me(e){switch(e){case 200:return"init";case 201:return"reply:";case 202:case 203:return"replyErr:";case 204:return"event:"}}class Ve{constructor(n,t,i=null,s=1e3){l(this,"channels",new Map);l(this,"activeRequests",new Map);l(this,"protocolListener");l(this,"pendingRequests",new Map);this.protocol=n,this.ctx=t,this.logger=i,this.timeoutDelay=s,this.protocolListener=this.protocol.onMessage(o=>this.onRawMessage(o)),this.sendResponse({type:200})}registerChannel(n,t){this.channels.set(n,t),setTimeout(()=>this.flushPendingRequests(n),0)}sendResponse(n){var t,i;switch(n.type){case 200:{this.send([n.type]),(t=this.logger)==null||t.logOutgoing(0,V.OtherSide,me(n.type));return}case 201:case 202:case 204:case 203:{this.send([n.type,n.id],n.data),(i=this.logger)==null||i.logOutgoing(n.id,V.OtherSide,me(n.type),n.data);return}}}send(n,t){try{return this.protocol.send({head:n,body:t}),1}catch{return 0}}onRawMessage(n){var o,r,u,m;const t=n.head,i=n.body,s=t[0];switch(s){case 100:return(o=this.logger)==null||o.logIncoming(t[1],V.OtherSide,`${Q(s)}: ${t[2]}.${t[3]}`,i),this.onPromise({type:s,id:t[1],channelName:t[2],name:t[3],arg:i});case 102:return(r=this.logger)==null||r.logIncoming(t[1],V.OtherSide,`${Q(s)}: ${t[2]}.${t[3]}`,i),this.onEventListen({type:s,id:t[1],channelName:t[2],name:t[3],arg:i});case 101:return(u=this.logger)==null||u.logIncoming(t[1],V.OtherSide,`${Q(s)}`),this.disposeActiveRequest({type:s,id:t[1]});case 103:return(m=this.logger)==null||m.logIncoming(t[1],V.OtherSide,`${Q(s)}`),this.disposeActiveRequest({type:s,id:t[1]})}}onPromise(n){const t=this.channels.get(n.channelName);if(!t){this.collectPendingRequest(n);return}const i=new He;let s;try{s=t.call(this.ctx,n.name,n.arg,i.token)}catch(u){s=Promise.reject(u)}const o=n.id;s.then(u=>{this.sendResponse({id:o,data:u,type:201}),this.activeRequests.delete(n.id)},u=>{u instanceof Error?this.sendResponse({id:o,data:{message:u.message,name:u.name,stack:u.stack?u.stack.split?u.stack.split(`
`):u.stack:void 0},type:202}):this.sendResponse({id:o,data:u,type:203}),this.activeRequests.delete(n.id)});const r=ne(()=>i.cancel());this.activeRequests.set(n.id,r)}onEventListen(n){const t=this.channels.get(n.channelName);if(!t){this.collectPendingRequest(n);return}const i=n.id,o=t.listen(this.ctx,n.name,n.arg)(r=>this.sendResponse({id:i,data:r,type:204}));this.activeRequests.set(n.id,o)}disposeActiveRequest(n){const t=this.activeRequests.get(n.id);t&&(t.dispose(),this.activeRequests.delete(n.id))}collectPendingRequest(n){let t=this.pendingRequests.get(n.channelName);t||(t=[],this.pendingRequests.set(n.channelName,t));const i=setTimeout(()=>{console.error(`Unknown channel: ${n.channelName}`),n.type===100&&this.sendResponse({id:n.id,data:{name:"Unknown channel",message:`Channel name '${n.channelName}' timed out after ${this.timeoutDelay}ms`,stack:void 0},type:202})},this.timeoutDelay);t.push({request:n,timeoutTimer:i})}flushPendingRequests(n){const t=this.pendingRequests.get(n);if(t){for(const i of t)switch(clearTimeout(i.timeoutTimer),i.request.type){case 100:this.onPromise(i.request);break;case 102:this.onEventListen(i.request);break}this.pendingRequests.delete(n)}}dispose(){this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),_e(this.activeRequests.values()),this.activeRequests.clear()}}var V=(e=>(e[e.LocalSide=0]="LocalSide",e[e.OtherSide=1]="OtherSide",e))(V||{});class De{constructor(n,t=null){l(this,"isDisposed",!1);l(this,"state",0);l(this,"activeRequests",new Set);l(this,"handlers",new Map);l(this,"lastRequestId",0);l(this,"protocolListener");l(this,"logger");l(this,"_onDidInitialize",new N);l(this,"onDidInitialize",this._onDidInitialize.event);this.protocol=n,this.protocolListener=this.protocol.onMessage(i=>this.onMessage(i)),this.logger=t}getChannel(n){const t=this;return{call(i,s,o){return t.isDisposed?Promise.reject(new $):t.requestPromise(n,i,s,o)},listen(i,s){return t.isDisposed?h.None:t.requestEvent(n,i,s)}}}requestPromise(n,t,i,s=te.None){const o=this.lastRequestId++,u={id:o,type:100,channelName:n,name:t,arg:i};if(s.isCancellationRequested)return Promise.reject(new $);let m;return new Promise((_,c)=>{if(s.isCancellationRequested)return c(new $);const a=()=>{const M=O=>{switch(O.type){case 201:this.handlers.delete(o),_(O.data);break;case 202:{this.handlers.delete(o);const b=new Error(O.data.message);b.stack=Array.isArray(O.data.stack)?O.data.stack.join(`
`):O.data.stack,b.name=O.data.name,c(b);break}case 203:this.handlers.delete(o),c(O.data);break}};this.handlers.set(o,M),this.sendRequest(u)};let v=null;this.state===1?a():(v=xe(M=>this.whenInitialized()),v.then(()=>{v=null,a()}));const y=()=>{v?(v.cancel(),v=null):this.sendRequest({id:o,type:101}),c(new $)},D=s.onCancellationRequested(y);m=Ne(ne(y),D),this.activeRequests.add(m)}).finally(()=>{this.activeRequests.delete(m)})}requestEvent(n,t,i){const s=this.lastRequestId++,r={id:s,type:102,channelName:n,name:t,arg:i};let u=null;const m=new N({onWillAddFirstListener:()=>{u=xe(_=>this.whenInitialized()),u.then(()=>{u=null,this.activeRequests.add(m),this.sendRequest(r)})},onDidRemoveLastListener:()=>{u?(u.cancel(),u=null):(this.activeRequests.delete(m),this.sendRequest({id:s,type:103}))}}),g=_=>m.fire(_.data);return this.handlers.set(s,g),m.event}sendRequest(n){var t,i;switch(n.type){case 100:case 102:{this.send([n.type,n.id,n.channelName,n.name],n.arg),(t=this.logger)==null||t.logOutgoing(n.id,0,`${Q(n.type)}: ${n.channelName}.${n.name}`,n.arg);return}case 101:case 103:{this.send([n.type,n.id]),(i=this.logger)==null||i.logOutgoing(n.id,0,Q(n.type));return}}}send(n,t){try{return this.protocol.send({head:n,body:t}),1}catch{return 0}}onMessage(n){var o,r;const t=n.head,i=n.body,s=t[0];switch(s){case 200:return(o=this.logger)==null||o.logIncoming(0,0,me(s)),this.onResponse({type:t[0]});case 201:case 202:case 204:case 203:return(r=this.logger)==null||r.logIncoming(t[1],0,me(s),i),this.onResponse({type:t[0],id:t[1],data:i})}}onResponse(n){if(n.type===200){this.state=1,this._onDidInitialize.fire();return}const t=this.handlers.get(n.id);t==null||t(n)}get onDidInitializePromise(){return h.toPromise(this.onDidInitialize)}whenInitialized(){return this.state===1?Promise.resolve():this.onDidInitializePromise}dispose(){this.isDisposed=!0,this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),_e(this.activeRequests.values()),this.activeRequests.clear()}}In([Ln],De.prototype,"onDidInitializePromise",1);class dn{constructor(n){l(this,"channels",new Map);l(this,"_connections",new Set);l(this,"_onDidAddConnection",new N);l(this,"onDidAddConnection",this._onDidAddConnection.event);l(this,"_onDidRemoveConnection",new N);l(this,"onDidRemoveConnection",this._onDidRemoveConnection.event);n(({protocol:t,onDidClientDisconnect:i})=>{h.once(t.onMessage)(o=>{const r=o,u=new Ve(t,r),m=new De(t);this.channels.forEach((_,c)=>u.registerChannel(c,_));const g={channelServer:u,channelClient:m,ctx:r};this._connections.add(g),this._onDidAddConnection.fire(g),i(()=>{u.dispose(),m.dispose(),this._connections.delete(g),this._onDidRemoveConnection.fire(g)})})})}get connections(){const n=[];return this._connections.forEach(t=>n.push(t)),n}getChannel(n,t){const i=this;return{call(s,o,r){let u;if(Se(t)){const g=An(i.connections.filter(t));u=g?Promise.resolve(g):h.toPromise(h.filter(i.onDidAddConnection,t))}else u=t.routeCall(i,s,o);const m=u.then(g=>g.channelClient.getChannel(n));return Ie(m).call(s,o,r)},listen(s,o){if(Se(t))return i.getMulticastEvent(n,t,s,o);const r=t.routeEvent(i,s,o).then(u=>u.channelClient.getChannel(n));return Ie(r).listen(s,o)}}}getMulticastEvent(n,t,i,s){const o=this;let r=new x;const u=new N({onWillAddFirstListener:()=>{r=new x;const m=new Un,g=new Map,_=a=>{const y=a.channelClient.getChannel(n).listen(i,s),D=m.add(y);g.set(a,D)},c=a=>{const v=g.get(a);!v||(v.dispose(),g.delete(a))};o.connections.filter(t).forEach(_),h.filter(o.onDidAddConnection,t)(_,void 0,r),o.onDidRemoveConnection(c,void 0,r),m.event(u.fire,u,r),r.add(m)},onDidRemoveLastListener:()=>{r.dispose()}});return u.event}registerChannel(n,t){this.channels.set(n,t),this._connections.forEach(i=>{i.channelServer.registerChannel(n,t)})}dispose(){this.channels.clear(),this._connections.clear(),this._onDidAddConnection.dispose(),this._onDidRemoveConnection.dispose()}}class hn{constructor(n,t,i=null){l(this,"channelClient");l(this,"channelServer");this.channelClient=new De(n,i),this.channelServer=new Ve(n,t,i)}getChannel(n){return this.channelClient.getChannel(n)}registerChannel(n,t){this.channelServer.registerChannel(n,t)}dispose(){this.channelClient.dispose(),this.channelServer.dispose()}}function Ie(e){return{call(n,t,i){return e.then(s=>s.call(n,t,i))},listen(n,t){const i=new vn;return e.then(s=>i.input=s.listen(n,t)),i.event}}}var je;(e=>{function n(o,r){const u=o,m=r&&r.disableMarshalling,g=new Map;for(const _ in u)i(_)&&g.set(_,h.buffer(u[_],!0));return new class{listen(_,c,a){const v=g.get(c);if(v)return v;if(s(c)){const y=u[c];if(typeof y=="function")return y.call(u,a)}throw new Error(`Event not found: ${c}`)}call(_,c,a){const v=u[c];if(typeof v=="function")return!m&&Array.isArray(a)&&Ke(),v.apply(u,a);throw new Error(`Method not found: ${c}`)}}}e.fromService=n;function t(o,r){const u=r&&r.disableMarshalling;return new Proxy({},{get(m,g){var _;if(typeof g=="string")return(_=r==null?void 0:r.properties)!=null&&_.has(g)?r.properties.get(g):s(g)?function(c){return o.listen(g,c)}:i(g)?o.listen(g):async function(...c){let a;r&&!tn(r.context)?a=[r.context,...c]:a=c;const v=await o.call(g,a);return u||Ke(),v};throw new Error(`Property not found: ${String(g)}`)}})}e.toService=t;function i(o){return o[0]==="o"&&o[1]==="n"&&$e(o.charCodeAt(2))}function s(o){return/^onDynamic/.test(o)&&$e(o.charCodeAt(9))}})(je||(je={}));class Xe{constructor(n){l(this,"onMessage");this.port=n,n.start(),this.onMessage=h.fromDOMEventEmitter(this.port,"message",t=>t.data)}send(n){this.port.postMessage(n)}disconnect(){this.port.close()}}class wn extends hn{constructor(t,i){const s=new Xe(t);super(s,i);l(this,"protocol");this.protocol=s}dispose(){this.protocol.disconnect()}}class On extends wn{constructor(n,t){super(n,t)}}var Qe=(e=>(e.createMessageChannel="createMessageChannel",e.createMessageChannelResult="createMessageChannelResult",e.transferMessageChannelResult="transferMessageChannelResult",e))(Qe||{});class de extends dn{static getOnDidClientConnect(){const n=h.fromDOMEventEmitter(self,"message",t=>t.data);return h.map(h.filter(n,t=>!!t&&t.command==="createMessageChannel"),t=>{const{port1:i,port2:s}=new MessageChannel,r={protocol:new Xe(i),onDidClientDisconnect:h.fromDOMEventEmitter(i,"close")};return self.postMessage({command:"createMessageChannelResult",arg:t.arg},{transfer:[s]}),r})}constructor(){super(de.getOnDidClientConnect())}}var he={exports:{}},we,Ye;function yn(){if(Ye)return we;Ye=1;var e=1e3,n=e*60,t=n*60,i=t*24,s=i*7,o=i*365.25;we=function(_,c){c=c||{};var a=typeof _;if(a==="string"&&_.length>0)return r(_);if(a==="number"&&isFinite(_))return c.long?m(_):u(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function r(_){if(_=String(_),!(_.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(!!c){var a=parseFloat(c[1]),v=(c[2]||"ms").toLowerCase();switch(v){case"years":case"year":case"yrs":case"yr":case"y":return a*o;case"weeks":case"week":case"w":return a*s;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"hrs":case"hr":case"h":return a*t;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}function u(_){var c=Math.abs(_);return c>=i?Math.round(_/i)+"d":c>=t?Math.round(_/t)+"h":c>=n?Math.round(_/n)+"m":c>=e?Math.round(_/e)+"s":_+"ms"}function m(_){var c=Math.abs(_);return c>=i?g(_,c,i,"day"):c>=t?g(_,c,t,"hour"):c>=n?g(_,c,n,"minute"):c>=e?g(_,c,e,"second"):_+" ms"}function g(_,c,a,v){var y=c>=a*1.5;return Math.round(_/a)+" "+v+(y?"s":"")}return we}function Mn(e){t.debug=t,t.default=t,t.coerce=m,t.disable=o,t.enable=s,t.enabled=r,t.humanize=yn(),t.destroy=g,Object.keys(e).forEach(_=>{t[_]=e[_]}),t.names=[],t.skips=[],t.formatters={};function n(_){let c=0;for(let a=0;a<_.length;a++)c=(c<<5)-c+_.charCodeAt(a),c|=0;return t.colors[Math.abs(c)%t.colors.length]}t.selectColor=n;function t(_){let c,a=null,v,y;function D(...M){if(!D.enabled)return;const O=D,b=Number(new Date),T=b-(c||b);O.diff=T,O.prev=c,O.curr=b,c=b,M[0]=t.coerce(M[0]),typeof M[0]!="string"&&M.unshift("%O");let A=0;M[0]=M[0].replace(/%([a-zA-Z%])/g,(R,f)=>{if(R==="%%")return"%";A++;const E=t.formatters[f];if(typeof E=="function"){const p=M[A];R=E.call(O,p),M.splice(A,1),A--}return R}),t.formatArgs.call(O,M),(O.log||t.log).apply(O,M)}return D.namespace=_,D.useColors=t.useColors(),D.color=t.selectColor(_),D.extend=i,D.destroy=t.destroy,Object.defineProperty(D,"enabled",{enumerable:!0,configurable:!1,get:()=>a!==null?a:(v!==t.namespaces&&(v=t.namespaces,y=t.enabled(_)),y),set:M=>{a=M}}),typeof t.init=="function"&&t.init(D),D}function i(_,c){const a=t(this.namespace+(typeof c>"u"?":":c)+_);return a.log=this.log,a}function s(_){t.save(_),t.namespaces=_,t.names=[],t.skips=[];let c;const a=(typeof _=="string"?_:"").split(/[\s,]+/),v=a.length;for(c=0;c<v;c++)!a[c]||(_=a[c].replace(/\*/g,".*?"),_[0]==="-"?t.skips.push(new RegExp("^"+_.slice(1)+"$")):t.names.push(new RegExp("^"+_+"$")))}function o(){const _=[...t.names.map(u),...t.skips.map(u).map(c=>"-"+c)].join(",");return t.enable(""),_}function r(_){if(_[_.length-1]==="*")return!0;let c,a;for(c=0,a=t.skips.length;c<a;c++)if(t.skips[c].test(_))return!1;for(c=0,a=t.names.length;c<a;c++)if(t.names[c].test(_))return!0;return!1}function u(_){return _.toString().substring(2,_.toString().length-2).replace(/\.\*\?$/,"*")}function m(_){return _ instanceof Error?_.stack||_.message:_}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Sn=Mn;(function(e,n){n.formatArgs=i,n.save=s,n.load=o,n.useColors=t,n.storage=r(),n.destroy=(()=>{let m=!1;return()=>{m||(m=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(m){if(m[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+m[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const g="color: "+this.color;m.splice(1,0,g,"color: inherit");let _=0,c=0;m[0].replace(/%[a-zA-Z%]/g,a=>{a!=="%%"&&(_++,a==="%c"&&(c=_))}),m.splice(c,0,g)}n.log=console.debug||console.log||(()=>{});function s(m){try{m?n.storage.setItem("debug",m):n.storage.removeItem("debug")}catch{}}function o(){let m;try{m=n.storage.getItem("debug")}catch{}return!m&&typeof process<"u"&&"env"in process&&(m=process.env.DEBUG),m}function r(){try{return localStorage}catch{}}e.exports=Sn(n);const{formatters:u}=e.exports;u.j=function(m){try{return JSON.stringify(m)}catch(g){return"[UnexpectedJSONParseError]: "+g.message}}})(he,he.exports);var Fn=he.exports;const S=2,Je=80*S,Nn=48*S,Ze=3*S,Ce=2*S,Y=3*S,j=15*S,J=74*S,Z=30*S,ge=Math.round;function en(){return(performance||Date).now()}const Me=class{constructor(n){l(this,"id",Me.ID++);l(this,"min",1/0);l(this,"max",0);l(this,"frames",0);l(this,"prevTime",0);l(this,"name","FPS");l(this,"fg","#0ff");l(this,"bg","#002");l(this,"context");this.canvas=n;const t=n.getContext("2d");this.context=t;const{name:i,bg:s,fg:o}=this;t.font="bold "+9*S+"px Helvetica,Arial,sans-serif",t.textBaseline="top",t.fillStyle=s,t.fillRect(0,0,Je,Nn),t.fillStyle=o,t.fillText(i,Ze,Ce),t.fillRect(Y,j,J,Z),t.fillStyle=s,t.globalAlpha=.9,t.fillRect(Y,j,J,Z)}begin(){this.prevTime=en()}update(){this.frames+=1;var n=en();n>=this.prevTime+1e3&&(this._update(this.frames*1e3/(n-this.prevTime),100),this.prevTime=n,this.frames=0)}_update(n,t){let{name:i,fg:s,bg:o,context:r,canvas:u}=this;this.min=Math.min(this.min,n),this.max=Math.max(this.max,n),r.fillStyle=o,r.globalAlpha=1,r.fillRect(0,0,Je,j),r.fillStyle=s,r.fillText(ge(n)+" "+i+" ("+ge(this.min)+"-"+ge(this.max)+")",Ze,Ce),r.drawImage(u,Y+S,j,J-S,Z,Y,j,J-S,Z),r.fillRect(Y+J-S,j,S,Z),r.fillStyle=o,r.globalAlpha=.9,r.fillRect(Y+J-S,j,S,ge((1-n/t)*Z))}};let Ee=Me;l(Ee,"ID",0);class kn{constructor(n){l(this,"onUpdate");l(this,"onTick");this.channel=n,this.onUpdate=this.channel.listen("onUpdate"),this.onTick=this.channel.listen("onTick")}echo(){return this.channel.call("echo")}getParticles(){return this.channel.call("getParticles")}load(n){return this.channel.call("load",n)}}function Bn(e,n){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}async function Pn(e,n,t,i,s){let o;s==null||s.begin();const r=u=>{const m=u.length;e.clearRect(0,0,t,i),e.globalCompositeOperation="lighter";for(var g=0;g<m;g++){for(var _=u[g],c=1,a=0;a<m;a++){var v=u[a];e.lineWidth=.5,_.rgba==v.rgba&&Bn(_,v)<50&&(e.strokeStyle=_.rgba,e.beginPath(),e.moveTo(_.x,_.y),e.lineTo(v.x,v.y),e.stroke(),c++)}e.fillStyle=_.rgba,e.strokeStyle=_.rgba,e.beginPath(),e.arc(_.x,_.y,_.rad*c,0,Math.PI*2,!0),e.fill(),e.closePath(),e.beginPath(),e.arc(_.x,_.y,(_.rad+5)*c,0,Math.PI*2,!0),e.stroke(),e.closePath()}s==null||s.update()};n.onTick(u=>{o&&cancelAnimationFrame(o),o=requestAnimationFrame(()=>r(u))})}class Gn{constructor(n,t,i){l(this,"_onUpdate",new N);l(this,"runningLongTask");this.ctx=n,this.model=t,this.panel=i}get onUpdate(){return this._onUpdate.event}echo(){return"hello render!"}async render(n){Pn(this.ctx,this.model,n.width,n.height,this.panel)}listen(n,t){switch(t){case"onUpdate":return this.onUpdate}return ze()}async call(n,t,i){switch(t){case"echo":return this.echo();case"render":return this.render(i);case"toggleLongTask":return this.toggleLongTask()}ze()}toggleLongTask(){if(this.runningLongTask)cancelAnimationFrame(this.runningLongTask),this.runningLongTask=void 0;else{const n=()=>{const t=Hn();Reflect.set(self,"test",t),this.runningLongTask=requestAnimationFrame(n)};n()}}}function Hn(){let e=1;for(let n=0;n<2e8;n++)e+=n;return e}const xn=Fn("editor:re");xn.enabled=!0;class Wn{constructor(){l(this,"withModelConnection");l(this,"server",new de);l(this,"onModelConnected",new We);l(this,"onCanvasConnected",new We);l(this,"renderService");l(this,"modelService");this.initService(),this.withModelConnection=this.connectModel(),this.modelService=new kn(this.getChannel(this.withModelConnection,"model")),this.modelService.echo().then(()=>{this.onModelConnected.complete()})}getChannel(n,t){return Ie(n.then(i=>i.getChannel(t)))}initService(){const n=h.filter(h.fromDOMEventEmitter(self,"message"),t=>!!t.data.canvas);h.once(n)(t=>{const{canvas:i,stat:s}=t.data,o=i.getContext("2d"),r=new Ee(s);this.renderService=new Gn(o,this.modelService,r),this.server.registerChannel("render",this.renderService),this.onCanvasConnected.complete()})}connectModel(){return new Promise(n=>{h.once(h.filter(h.fromDOMEventEmitter(self,"message"),i=>!!i.data.port))(i=>{const{channelName:s}=i.data;n(new On(i.ports[0],s)),Promise.all([this.onModelConnected.p,this.onCanvasConnected.p]).then(()=>{self.postMessage({command:Qe.transferMessageChannelResult,arg:s})})})})}}new Wn})();
