var Ze=Object.defineProperty;var Ce=(e,t,n)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var l=(e,t,n)=>(Ce(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const _ of s)if(_.type==="childList")for(const r of _.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const _={};return s.integrity&&(_.integrity=s.integrity),s.referrerpolicy&&(_.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?_.credentials="include":s.crossorigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function i(s){if(s.ep)return;s.ep=!0;const _=n(s);fetch(s.href,_)}})();function et(e){const t=this;let n=!1,i;return function(){return n||(n=!0,i=e.apply(t,arguments)),i}}var be;(e=>{function t(p){return p&&typeof p=="object"&&typeof p[Symbol.iterator]=="function"}e.is=t;const n=Object.freeze([]);function i(){return n}e.empty=i;function*s(p){yield p}e.single=s;function _(p){return p||n}e.from=_;function r(p){return!p||p[Symbol.iterator]().next().done===!0}e.isEmpty=r;function u(p){return p[Symbol.iterator]().next().value}e.first=u;function f(p,v){for(const L of p)if(v(L))return!0;return!1}e.some=f;function b(p,v){for(const L of p)if(v(L))return L}e.find=b;function*o(p,v){for(const L of p)v(L)&&(yield L)}e.filter=o;function*c(p,v){let L=0;for(const F of p)yield v(F,L++)}e.map=c;function*m(...p){for(const v of p)for(const L of v)yield L}e.concat=m;function*A(p){for(const v of p)for(const L of v)yield L}e.concatNested=A;function S(p,v,L){let F=L;for(const E of p)F=v(F,E);return F}e.reduce=S;function*w(p,v,L=p.length){for(v<0&&(v+=p.length),L<0?L+=p.length:L>p.length&&(L=p.length);v<L;v++)yield p[v]}e.slice=w;function O(p,v=Number.POSITIVE_INFINITY){const L=[];if(v===0)return[L,p];const F=p[Symbol.iterator]();for(let E=0;E<v;E++){const a=F.next();if(a.done)return[L,e.empty()];L.push(a.value)}return[L,{[Symbol.iterator](){return F}}]}e.consume=O;function h(p,v,L=(F,E)=>F===E){const F=p[Symbol.iterator](),E=v[Symbol.iterator]();for(;;){const a=F.next(),g=E.next();if(a.done!==g.done)return!1;if(a.done)return!0;if(!L(a.value,g.value))return!1}}e.equals=h})(be||(be={}));function tt(e){return typeof e>"u"}function nt(e){return tt(e)||e===null}let G=null;function ae(e){return G==null||G.trackDisposable(e),e}function fe(e){G==null||G.markAsDisposed(e)}function We(e,t){G==null||G.setParent(e,t)}class it extends Error{constructor(t){super(`Encountered errors while disposing of store. Errors: [${t.join(", ")}]`),this.errors=t}}function me(e){if(be.is(e)){const t=[];for(const n of e)if(n)try{n.dispose()}catch(i){t.push(i)}if(t.length===1)throw t[0];if(t.length>1)throw new it(t);return Array.isArray(e)?[]:e}else if(e)return e.dispose(),e}function qe(...e){return ge(()=>me(e))}function ge(e){const t=ae({dispose:et(()=>{fe(t),e()})});return t}const De=class{constructor(){l(this,"_toDispose",new Set);l(this,"_isDisposed",!1);ae(this)}dispose(){this._isDisposed||(fe(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){try{me(this._toDispose.values())}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return We(t,this),this._isDisposed?De.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}};let z=De;l(z,"DISABLE_DISPOSED_WARNING",!1);class Ee{constructor(){l(this,"$$disposed",!1);l(this,"_store",new z);ae(this),We(this._store,this)}dispose(){this.$$disposed=!0,fe(this),this._store.dispose()}_register(t){if(t===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(t)}}l(Ee,"None",Object.freeze({dispose(){}}));class st{constructor(){l(this,"dispose",()=>{});l(this,"unset",()=>{});l(this,"isset",()=>!1);ae(this)}set(t){let n=t;return this.unset=()=>n=void 0,this.isset=()=>n!==void 0,this.dispose=()=>{n&&(n(),n=void 0,fe(this))},this}}const C=class{constructor(t){l(this,"element");l(this,"next");l(this,"prev");this.element=t,this.next=C.Undefined,this.prev=C.Undefined}};let D=C;l(D,"Undefined",new C(void 0));class Ue{constructor(){l(this,"_first",D.Undefined);l(this,"_last",D.Undefined);l(this,"_size",0)}get size(){return this._size}isEmpty(){return this._first===D.Undefined}clear(){this._first=D.Undefined,this._last=D.Undefined,this._size=0}unshift(t){return this._insert(t,!1)}push(t){return this._insert(t,!0)}_insert(t,n){const i=new D(t);if(this._first===D.Undefined)this._first=i,this._last=i;else if(n){const _=this._last;this._last=i,i.prev=_,_.next=i}else{const _=this._first;this._first=i,i.next=_,_.prev=i}this._size+=1;let s=!1;return()=>{s||(s=!0,this._remove(i))}}shift(){if(this._first!==D.Undefined){const t=this._first.element;return this._remove(this._first),t}}pop(){if(this._last!==D.Undefined){const t=this._last.element;return this._remove(this._last),t}}_remove(t){if(t.prev!==D.Undefined&&t.next!==D.Undefined){const n=t.prev;n.next=t.next,t.next.prev=n}else t.prev===D.Undefined&&t.next===D.Undefined?(this._first=D.Undefined,this._last=D.Undefined):t.next===D.Undefined?(this._last=this._last.prev,this._last.next=D.Undefined):t.prev===D.Undefined&&(this._first=this._first.next,this._first.prev=D.Undefined);this._size-=1}*[Symbol.iterator](){let t=this._first;for(;t!==D.Undefined;)yield t.element,t=t.next}}class _t{constructor(){l(this,"unexpectedErrorHandler");l(this,"listeners");this.listeners=[],this.unexpectedErrorHandler=function(t){setTimeout(()=>{throw t.stack?new Error(t.message+`

`+t.stack):t},0)}}addListener(t){return this.listeners.push(t),()=>{this._removeListener(t)}}emit(t){this.listeners.forEach(n=>{n(t)})}_removeListener(t){this.listeners.splice(this.listeners.indexOf(t),1)}setUnexpectedErrorHandler(t){this.unexpectedErrorHandler=t}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(t){this.unexpectedErrorHandler(t),this.emit(t)}onUnexpectedExternalError(t){this.unexpectedErrorHandler(t)}}const ot=new _t;function lt(e){rt(e)||ot.onUnexpectedError(e)}const Ae="Canceled";function rt(e){return e instanceof J?!0:e instanceof Error&&e.name===Ae&&e.message===Ae}class J extends Error{constructor(){super(Ae),this.name=this.message}}const _e="en";let Re=!1,Ke=!1,ie,oe=_e,ct,x;const k=typeof self=="object"?self:typeof global=="object"?global:{};let d;typeof k.vscode<"u"&&typeof k.vscode.process<"u"?d=k.vscode.process:typeof process<"u"&&(d=process);var xe;const ut=typeof((xe=d==null?void 0:d.versions)==null?void 0:xe.electron)=="string",ze=ut&&(d==null?void 0:d.type)==="renderer";ze&&(d==null||d.sandboxed);if(typeof navigator=="object"&&!ze)x=navigator.userAgent,x.indexOf("Windows")>=0,x.indexOf("Macintosh")>=0,(x.indexOf("Macintosh")>=0||x.indexOf("iPad")>=0||x.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Re=x.indexOf("Linux")>=0,Ke=!0,ie=navigator.language,oe=ie;else if(typeof d=="object"){d.platform,d.platform,Re=d.platform==="linux",Re&&!!d.env.SNAP&&d.env.SNAP_REVISION,d.env.CI||d.env.BUILD_ARTIFACTSTAGINGDIRECTORY,ie=_e,oe=_e;const e=d.env.VSCODE_NLS_CONFIG;if(e)try{const t=JSON.parse(e),n=t.availableLanguages["*"];ie=t.locale,oe=n||_e,ct=t._translationsConfigFile}catch{}}else console.error("Unable to resolve platform.");Ke&&k.importScripts;const B=x,H=oe;var Oe;(e=>{function t(){return H}e.value=t;function n(){return H.length===2?H==="en":H.length>=3?H[0]==="e"&&H[1]==="n"&&H[2]==="-":!1}e.isDefaultVariant=n;function i(){return H==="en"}e.isDefault=i})(Oe||(Oe={}));(()=>{if(typeof k.postMessage=="function"&&!k.importScripts){const e=[];k.addEventListener("message",n=>{if(n.data&&n.data.vscodeScheduleAsyncWork)for(let i=0,s=e.length;i<s;i++){const _=e[i];if(_.id===n.data.vscodeScheduleAsyncWork){e.splice(i,1),_.callback();return}}});let t=0;return n=>{const i=++t;e.push({id:i,callback:n}),k.postMessage({vscodeScheduleAsyncWork:i},"*")}}return e=>setTimeout(e)})();const at=!!(B&&B.indexOf("Chrome")>=0);B&&B.indexOf("Firefox")>=0;!at&&B&&B.indexOf("Safari")>=0;B&&B.indexOf("Edg/")>=0;B&&B.indexOf("Android")>=0;const ft=k.performance&&typeof k.performance.now=="function";class Ie{constructor(t){l(this,"_highResolution");l(this,"_startTime");l(this,"_stopTime");this._highResolution=ft&&t,this._startTime=this._now(),this._stopTime=-1}static create(t=!0){return new Ie(t)}stop(){this._stopTime=this._now()}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}_now(){return this._highResolution?k.performance.now():Date.now()}}const he=class{constructor(t){l(this,"_name");l(this,"_stopWatch");l(this,"_listenerCount",0);l(this,"_invocationCount",0);l(this,"_elapsedOverall",0);this._name=`${t}_${he._idPool++}`}start(t){this._stopWatch=new Ie(!0),this._listenerCount=t}stop(){if(this._stopWatch){const t=this._stopWatch.elapsed();this._elapsedOverall+=t,this._invocationCount+=1,console.info(`did FIRE ${this._name}: elapsed_ms: ${t.toFixed(5)}, listener: ${this._listenerCount} (elapsed_overall: ${this._elapsedOverall.toFixed(2)}, invocations: ${this._invocationCount})`),this._stopWatch=void 0}}};let le=he;l(le,"_idPool",0);let mt=-1;var y;(e=>{e.None=()=>Ee.None;function t(E,a){return o(E,()=>{},0,void 0,!0,void 0,a)}e.defer=t;function n(E){return(a,g=null,R)=>{let U=!1,T;return T=E(I=>{if(!U)return T?T.dispose():U=!0,a.call(g,I)},null,R),U&&T.dispose(),T}}e.once=n;function i(E,a,g){return b((R,U=null,T)=>E(I=>R.call(U,a(I)),null,T),g)}e.map=i;function s(E,a,g){return b((R,U=null,T)=>E(I=>{a(I),R.call(U,I)},null,T),g)}e.forEach=s;function _(E,a,g){return b((R,U=null,T)=>E(I=>a(I)&&R.call(U,I),null,T),g)}e.filter=_;function r(E){return E}e.signal=r;function u(...E){return(a,g=null,R)=>qe(...E.map(U=>U(T=>a.call(g,T),null,R)))}e.any=u;function f(E,a,g,R){let U=g;return i(E,T=>(U=a(U,T),U),R)}e.reduce=f;function b(E,a){let g;const R={onWillAddFirstListener(){g=E(U.fire,U)},onDidRemoveLastListener(){g==null||g.dispose()}},U=new P(R);return a==null||a.add(U),U.event}function o(E,a,g=100,R=!1,U=!1,T,I){let N,$,V,te=0,W;const Qe={leakWarningThreshold:T,onWillAddFirstListener(){N=E(Ye=>{te++,$=a($,Ye),R&&!V&&(ne.fire($),$=void 0),W=()=>{const Je=$;$=void 0,V=void 0,(!R||te>1)&&ne.fire(Je),te=0},typeof g=="number"?(clearTimeout(V),V=setTimeout(W,g)):V===void 0&&(V=0,queueMicrotask(W))})},onWillRemoveListener(){U&&te>0&&(W==null||W())},onDidRemoveLastListener(){W=void 0,N.dispose()}},ne=new P(Qe);return I==null||I.add(ne),ne.event}e.debounce=o;function c(E,a=0,g){return e.debounce(E,(R,U)=>R?(R.push(U),R):[U],a,void 0,!0,void 0,g)}e.accumulate=c;function m(E,a=(R,U)=>R===U,g){let R=!0,U;return _(E,T=>{const I=R||!a(T,U);return R=!1,U=T,I},g)}e.latch=m;function A(E,a,g){return[e.filter(E,a,g),e.filter(E,R=>!a(R),g)]}e.split=A;function S(E,a=!1,g=[]){let R=g.slice(),U=E(N=>{R?R.push(N):I.fire(N)});const T=()=>{R==null||R.forEach(N=>I.fire(N)),R=null},I=new P({onWillAddFirstListener(){U||(U=E(N=>I.fire(N)))},onDidAddFirstListener(){R&&(a?setTimeout(T):T())},onDidRemoveLastListener(){U&&U.dispose(),U=null}});return I.event}e.buffer=S;class w{constructor(a){l(this,"disposables",new z);this.event=a}map(a){return new w(i(this.event,a,this.disposables))}forEach(a){return new w(s(this.event,a,this.disposables))}filter(a){return new w(_(this.event,a,this.disposables))}reduce(a,g){return new w(f(this.event,a,g,this.disposables))}latch(){return new w(m(this.event,void 0,this.disposables))}debounce(a,g=100,R=!1,U=!1,T){return new w(o(this.event,a,g,R,U,T,this.disposables))}on(a,g,R){return this.event(a,g,R)}once(a,g,R){return n(this.event)(a,g,R)}dispose(){this.disposables.dispose()}}function O(E){return new w(E)}e.chain=O;function h(E,a,g=R=>R){const R=(...N)=>I.fire(g(...N)),U=()=>E.on(a,R),T=()=>E.removeListener(a,R),I=new P({onWillAddFirstListener:U,onDidRemoveLastListener:T});return I.event}e.fromNodeEventEmitter=h;function p(E,a,g=R=>R){const R=(...N)=>I.fire(g(...N)),U=()=>E.addEventListener(a,R),T=()=>E.removeEventListener(a,R),I=new P({onWillAddFirstListener:U,onDidRemoveLastListener:T});return I.event}e.fromDOMEventEmitter=p;function v(E){return new Promise(a=>n(E)(a))}e.toPromise=v;function L(E,a){return a(void 0),E(g=>a(g))}e.runAndSubscribe=L;function F(E,a){let g=null;function R(T){g==null||g.dispose(),g=new z,a(T,g)}R(void 0);const U=E(T=>R(T));return ge(()=>{U.dispose(),g==null||g.dispose()})}e.runAndSubscribeWithStore=F})(y||(y={}));class gt{constructor(t,n=Math.random().toString(18).slice(2,5)){l(this,"_stacks");l(this,"_warnCountdown",0);this.threshold=t,this.name=n}dispose(){var t;(t=this._stacks)==null||t.clear()}check(t,n){const i=this.threshold;if(i<=0||n<i)return;this._stacks||(this._stacks=new Map);const s=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,s+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=i*.5;let _,r=0;for(const[u,f]of this._stacks)(!_||r<f)&&(_=u,r=f);console.warn(`[${this.name}] potential listener LEAK detected, having ${n} listeners already. MOST frequent listener (${r}):`),console.warn(_)}return()=>{const _=this._stacks.get(t.value)||0;this._stacks.set(t.value,_-1)}}}class we{constructor(t){this.value=t}static create(){var t;return new we((t=new Error().stack)!=null?t:"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}}class Et{constructor(t,n,i){l(this,"subscription",new st);this.callback=t,this.callbackThis=n,this.stack=i}invoke(t){this.callback.call(this.callbackThis,t)}}class P{constructor(t){l(this,"_options");l(this,"_leakageMon");l(this,"_perfMon");l(this,"_disposed",!1);l(this,"_event");l(this,"_deliveryQueue");l(this,"_listeners");var n,i,s,_,r;this._options=t,this._leakageMon=(n=this._options)!=null&&n.leakWarningThreshold?new gt((s=(i=this._options)==null?void 0:i.leakWarningThreshold)!=null?s:mt):void 0,this._perfMon=(_=this._options)!=null&&_._profName?new le(this._options._profName):void 0,this._deliveryQueue=(r=this._options)==null?void 0:r.deliveryQueue}dispose(){var t,n,i,s;this._disposed||(this._disposed=!0,this._listeners&&this._listeners.clear(),(t=this._deliveryQueue)==null||t.clear(this),(i=(n=this._options)==null?void 0:n.onDidRemoveLastListener)==null||i.call(n),(s=this._leakageMon)==null||s.dispose())}get event(){return this._event||(this._event=(t,n,i)=>{var o,c,m;if(this._listeners||(this._listeners=new Ue),this._leakageMon&&this._listeners.size>this._leakageMon.threshold*3)return console.warn(`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far`),Ee.None;const s=this._listeners.isEmpty();s&&((o=this._options)==null?void 0:o.onWillAddFirstListener)&&this._options.onWillAddFirstListener(this);let _,r;this._leakageMon&&this._listeners.size>=Math.ceil(this._leakageMon.threshold*.2)&&(r=we.create(),_=this._leakageMon.check(r,this._listeners.size+1));const u=new Et(t,n,r),f=this._listeners.push(u);s&&((c=this._options)==null?void 0:c.onDidAddFirstListener)&&this._options.onDidAddFirstListener(this),(m=this._options)!=null&&m.onDidAddListener&&this._options.onDidAddListener(this,t,n);const b=u.subscription.set(()=>{var A,S;_==null||_(),this._disposed||((S=(A=this._options)==null?void 0:A.onWillRemoveListener)==null||S.call(A,this),f(),this._options&&this._options.onDidRemoveLastListener&&(this._listeners&&!this._listeners.isEmpty()||this._options.onDidRemoveLastListener(this)))});return i instanceof z?i.add(b):Array.isArray(i)&&i.push(b),b}),this._event}fire(t){var n,i,s;if(this._listeners){this._deliveryQueue||(this._deliveryQueue=new pt((n=this._options)==null?void 0:n.onListenerError));for(const _ of this._listeners)this._deliveryQueue.push(this,_,t);(i=this._perfMon)==null||i.start(this._deliveryQueue.size),this._deliveryQueue.deliver(),(s=this._perfMon)==null||s.stop()}}hasListeners(){return this._listeners?!this._listeners.isEmpty():!1}}class Rt{constructor(t=lt){l(this,"_queue",new Ue);this._onListenerError=t}get size(){return this._queue.size}push(t,n,i){this._queue.push(new bt(t,n,i))}clear(t){const n=new Ue;for(const i of this._queue)i.emitter!==t&&n.push(i);this._queue=n}deliver(){for(;this._queue.size>0;){const t=this._queue.shift();try{t.listener.invoke(t.event)}catch(n){this._onListenerError(n)}}}}class pt extends Rt{clear(t){this._queue.clear()}}class bt{constructor(t,n,i){this.emitter=t,this.listener=n,this.event=i}}class Ut{constructor(){l(this,"listening",!1);l(this,"inputEvent",y.None);l(this,"inputEventListener",Ee.None);l(this,"emitter",new P({onDidAddFirstListener:()=>{this.listening=!0,this.inputEventListener=this.inputEvent(this.emitter.fire,this.emitter)},onDidRemoveLastListener:()=>{this.listening=!1,this.inputEventListener.dispose()}}));l(this,"event",this.emitter.event)}set input(t){this.inputEvent=t,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=t(this.emitter.fire,this.emitter))}dispose(){this.inputEventListener.dispose(),this.emitter.dispose()}}const $e=Object.freeze(function(e,t){const n=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(n)}}});var ee;(e=>{function t(n){return n===e.None||n===e.Cancelled||n instanceof re?!0:!n||typeof n!="object"?!1:typeof n.isCancellationRequested=="boolean"&&typeof n.onCancellationRequested=="function"}e.isCancellationToken=t,e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:y.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:$e})})(ee||(ee={}));class re{constructor(){l(this,"_isCancelled",!1);l(this,"_emitter",null)}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?$e:(this._emitter||(this._emitter=new P),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}}class Ve{constructor(t){l(this,"_token");l(this,"_parentListener");this._parentListener=t&&t.onCancellationRequested(this.cancel,this)}get token(){return this._token||(this._token=new re),this._token}cancel(){this._token?this._token instanceof re&&this._token.cancel():this._token=ee.Cancelled}dispose(t=!1){t&&this.cancel(),this._parentListener&&this._parentListener.dispose(),this._token?this._token instanceof re&&this._token.dispose():this._token=ee.None}}function ye(e){const t=new Ve,n=e(t.token),i=new Promise((s,_)=>{const r=t.token.onCancellationRequested(()=>{r.dispose(),t.dispose(),_(new J)});Promise.resolve(n).then(u=>{r.dispose(),t.dispose(),s(u)},u=>{r.dispose(),t.dispose(),_(u)})});return new class{cancel(){t.cancel()}then(s,_){return i.then(s,_)}catch(s){return this.then(void 0,s)}finally(s){return i.finally(s)}}}(function(){(typeof requestIdleCallback!="function"||typeof cancelIdleCallback!="function")&&Object.freeze({didTimeout:!0,timeRemaining(){return 15}})})();var Se;(e=>{async function t(i){let s;const _=await Promise.all(i.map(r=>r.then(u=>u,u=>{s||(s=u)})));if(typeof s<"u")throw s;return _}e.settled=t;function n(i){return new Promise(async(s,_)=>{try{await i(s,_)}catch(r){_(r)}})}e.withAsyncBody=n})(Se||(Se={}));function At(e,t,n){let i=null,s=null;if(typeof n.value=="function"?(i="value",s=n.value,s.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof n.get=="function"&&(i="get",s=n.get),!s)throw new Error("not supported");const _=`$memoize$${t}`;n[i]=function(...r){return this.hasOwnProperty(_)||Object.defineProperty(this,_,{configurable:!1,enumerable:!1,writable:!1,value:s.apply(this,r)}),this[_]}}function Me(...e){throw e.length&&console.error(...e),new Error("not reached")}var Le=(e=>(e[e.Null=0]="Null",e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.LineFeed=10]="LineFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.DoubleQuote=34]="DoubleQuote",e[e.Hash=35]="Hash",e[e.DollarSign=36]="DollarSign",e[e.PercentSign=37]="PercentSign",e[e.Ampersand=38]="Ampersand",e[e.SingleQuote=39]="SingleQuote",e[e.OpenParen=40]="OpenParen",e[e.CloseParen=41]="CloseParen",e[e.Asterisk=42]="Asterisk",e[e.Plus=43]="Plus",e[e.Comma=44]="Comma",e[e.Dash=45]="Dash",e[e.Period=46]="Period",e[e.Slash=47]="Slash",e[e.Digit0=48]="Digit0",e[e.Digit1=49]="Digit1",e[e.Digit2=50]="Digit2",e[e.Digit3=51]="Digit3",e[e.Digit4=52]="Digit4",e[e.Digit5=53]="Digit5",e[e.Digit6=54]="Digit6",e[e.Digit7=55]="Digit7",e[e.Digit8=56]="Digit8",e[e.Digit9=57]="Digit9",e[e.Colon=58]="Colon",e[e.Semicolon=59]="Semicolon",e[e.LessThan=60]="LessThan",e[e.Equals=61]="Equals",e[e.GreaterThan=62]="GreaterThan",e[e.QuestionMark=63]="QuestionMark",e[e.AtSign=64]="AtSign",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.OpenSquareBracket=91]="OpenSquareBracket",e[e.Backslash=92]="Backslash",e[e.CloseSquareBracket=93]="CloseSquareBracket",e[e.Caret=94]="Caret",e[e.Underline=95]="Underline",e[e.BackTick=96]="BackTick",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e[e.OpenCurlyBrace=123]="OpenCurlyBrace",e[e.Pipe=124]="Pipe",e[e.CloseCurlyBrace=125]="CloseCurlyBrace",e[e.Tilde=126]="Tilde",e[e.U_Combining_Grave_Accent=768]="U_Combining_Grave_Accent",e[e.U_Combining_Acute_Accent=769]="U_Combining_Acute_Accent",e[e.U_Combining_Circumflex_Accent=770]="U_Combining_Circumflex_Accent",e[e.U_Combining_Tilde=771]="U_Combining_Tilde",e[e.U_Combining_Macron=772]="U_Combining_Macron",e[e.U_Combining_Overline=773]="U_Combining_Overline",e[e.U_Combining_Breve=774]="U_Combining_Breve",e[e.U_Combining_Dot_Above=775]="U_Combining_Dot_Above",e[e.U_Combining_Diaeresis=776]="U_Combining_Diaeresis",e[e.U_Combining_Hook_Above=777]="U_Combining_Hook_Above",e[e.U_Combining_Ring_Above=778]="U_Combining_Ring_Above",e[e.U_Combining_Double_Acute_Accent=779]="U_Combining_Double_Acute_Accent",e[e.U_Combining_Caron=780]="U_Combining_Caron",e[e.U_Combining_Vertical_Line_Above=781]="U_Combining_Vertical_Line_Above",e[e.U_Combining_Double_Vertical_Line_Above=782]="U_Combining_Double_Vertical_Line_Above",e[e.U_Combining_Double_Grave_Accent=783]="U_Combining_Double_Grave_Accent",e[e.U_Combining_Candrabindu=784]="U_Combining_Candrabindu",e[e.U_Combining_Inverted_Breve=785]="U_Combining_Inverted_Breve",e[e.U_Combining_Turned_Comma_Above=786]="U_Combining_Turned_Comma_Above",e[e.U_Combining_Comma_Above=787]="U_Combining_Comma_Above",e[e.U_Combining_Reversed_Comma_Above=788]="U_Combining_Reversed_Comma_Above",e[e.U_Combining_Comma_Above_Right=789]="U_Combining_Comma_Above_Right",e[e.U_Combining_Grave_Accent_Below=790]="U_Combining_Grave_Accent_Below",e[e.U_Combining_Acute_Accent_Below=791]="U_Combining_Acute_Accent_Below",e[e.U_Combining_Left_Tack_Below=792]="U_Combining_Left_Tack_Below",e[e.U_Combining_Right_Tack_Below=793]="U_Combining_Right_Tack_Below",e[e.U_Combining_Left_Angle_Above=794]="U_Combining_Left_Angle_Above",e[e.U_Combining_Horn=795]="U_Combining_Horn",e[e.U_Combining_Left_Half_Ring_Below=796]="U_Combining_Left_Half_Ring_Below",e[e.U_Combining_Up_Tack_Below=797]="U_Combining_Up_Tack_Below",e[e.U_Combining_Down_Tack_Below=798]="U_Combining_Down_Tack_Below",e[e.U_Combining_Plus_Sign_Below=799]="U_Combining_Plus_Sign_Below",e[e.U_Combining_Minus_Sign_Below=800]="U_Combining_Minus_Sign_Below",e[e.U_Combining_Palatalized_Hook_Below=801]="U_Combining_Palatalized_Hook_Below",e[e.U_Combining_Retroflex_Hook_Below=802]="U_Combining_Retroflex_Hook_Below",e[e.U_Combining_Dot_Below=803]="U_Combining_Dot_Below",e[e.U_Combining_Diaeresis_Below=804]="U_Combining_Diaeresis_Below",e[e.U_Combining_Ring_Below=805]="U_Combining_Ring_Below",e[e.U_Combining_Comma_Below=806]="U_Combining_Comma_Below",e[e.U_Combining_Cedilla=807]="U_Combining_Cedilla",e[e.U_Combining_Ogonek=808]="U_Combining_Ogonek",e[e.U_Combining_Vertical_Line_Below=809]="U_Combining_Vertical_Line_Below",e[e.U_Combining_Bridge_Below=810]="U_Combining_Bridge_Below",e[e.U_Combining_Inverted_Double_Arch_Below=811]="U_Combining_Inverted_Double_Arch_Below",e[e.U_Combining_Caron_Below=812]="U_Combining_Caron_Below",e[e.U_Combining_Circumflex_Accent_Below=813]="U_Combining_Circumflex_Accent_Below",e[e.U_Combining_Breve_Below=814]="U_Combining_Breve_Below",e[e.U_Combining_Inverted_Breve_Below=815]="U_Combining_Inverted_Breve_Below",e[e.U_Combining_Tilde_Below=816]="U_Combining_Tilde_Below",e[e.U_Combining_Macron_Below=817]="U_Combining_Macron_Below",e[e.U_Combining_Low_Line=818]="U_Combining_Low_Line",e[e.U_Combining_Double_Low_Line=819]="U_Combining_Double_Low_Line",e[e.U_Combining_Tilde_Overlay=820]="U_Combining_Tilde_Overlay",e[e.U_Combining_Short_Stroke_Overlay=821]="U_Combining_Short_Stroke_Overlay",e[e.U_Combining_Long_Stroke_Overlay=822]="U_Combining_Long_Stroke_Overlay",e[e.U_Combining_Short_Solidus_Overlay=823]="U_Combining_Short_Solidus_Overlay",e[e.U_Combining_Long_Solidus_Overlay=824]="U_Combining_Long_Solidus_Overlay",e[e.U_Combining_Right_Half_Ring_Below=825]="U_Combining_Right_Half_Ring_Below",e[e.U_Combining_Inverted_Bridge_Below=826]="U_Combining_Inverted_Bridge_Below",e[e.U_Combining_Square_Below=827]="U_Combining_Square_Below",e[e.U_Combining_Seagull_Below=828]="U_Combining_Seagull_Below",e[e.U_Combining_X_Above=829]="U_Combining_X_Above",e[e.U_Combining_Vertical_Tilde=830]="U_Combining_Vertical_Tilde",e[e.U_Combining_Double_Overline=831]="U_Combining_Double_Overline",e[e.U_Combining_Grave_Tone_Mark=832]="U_Combining_Grave_Tone_Mark",e[e.U_Combining_Acute_Tone_Mark=833]="U_Combining_Acute_Tone_Mark",e[e.U_Combining_Greek_Perispomeni=834]="U_Combining_Greek_Perispomeni",e[e.U_Combining_Greek_Koronis=835]="U_Combining_Greek_Koronis",e[e.U_Combining_Greek_Dialytika_Tonos=836]="U_Combining_Greek_Dialytika_Tonos",e[e.U_Combining_Greek_Ypogegrammeni=837]="U_Combining_Greek_Ypogegrammeni",e[e.U_Combining_Bridge_Above=838]="U_Combining_Bridge_Above",e[e.U_Combining_Equals_Sign_Below=839]="U_Combining_Equals_Sign_Below",e[e.U_Combining_Double_Vertical_Line_Below=840]="U_Combining_Double_Vertical_Line_Below",e[e.U_Combining_Left_Angle_Below=841]="U_Combining_Left_Angle_Below",e[e.U_Combining_Not_Tilde_Above=842]="U_Combining_Not_Tilde_Above",e[e.U_Combining_Homothetic_Above=843]="U_Combining_Homothetic_Above",e[e.U_Combining_Almost_Equal_To_Above=844]="U_Combining_Almost_Equal_To_Above",e[e.U_Combining_Left_Right_Arrow_Below=845]="U_Combining_Left_Right_Arrow_Below",e[e.U_Combining_Upwards_Arrow_Below=846]="U_Combining_Upwards_Arrow_Below",e[e.U_Combining_Grapheme_Joiner=847]="U_Combining_Grapheme_Joiner",e[e.U_Combining_Right_Arrowhead_Above=848]="U_Combining_Right_Arrowhead_Above",e[e.U_Combining_Left_Half_Ring_Above=849]="U_Combining_Left_Half_Ring_Above",e[e.U_Combining_Fermata=850]="U_Combining_Fermata",e[e.U_Combining_X_Below=851]="U_Combining_X_Below",e[e.U_Combining_Left_Arrowhead_Below=852]="U_Combining_Left_Arrowhead_Below",e[e.U_Combining_Right_Arrowhead_Below=853]="U_Combining_Right_Arrowhead_Below",e[e.U_Combining_Right_Arrowhead_And_Up_Arrowhead_Below=854]="U_Combining_Right_Arrowhead_And_Up_Arrowhead_Below",e[e.U_Combining_Right_Half_Ring_Above=855]="U_Combining_Right_Half_Ring_Above",e[e.U_Combining_Dot_Above_Right=856]="U_Combining_Dot_Above_Right",e[e.U_Combining_Asterisk_Below=857]="U_Combining_Asterisk_Below",e[e.U_Combining_Double_Ring_Below=858]="U_Combining_Double_Ring_Below",e[e.U_Combining_Zigzag_Above=859]="U_Combining_Zigzag_Above",e[e.U_Combining_Double_Breve_Below=860]="U_Combining_Double_Breve_Below",e[e.U_Combining_Double_Breve=861]="U_Combining_Double_Breve",e[e.U_Combining_Double_Macron=862]="U_Combining_Double_Macron",e[e.U_Combining_Double_Macron_Below=863]="U_Combining_Double_Macron_Below",e[e.U_Combining_Double_Tilde=864]="U_Combining_Double_Tilde",e[e.U_Combining_Double_Inverted_Breve=865]="U_Combining_Double_Inverted_Breve",e[e.U_Combining_Double_Rightwards_Arrow_Below=866]="U_Combining_Double_Rightwards_Arrow_Below",e[e.U_Combining_Latin_Small_Letter_A=867]="U_Combining_Latin_Small_Letter_A",e[e.U_Combining_Latin_Small_Letter_E=868]="U_Combining_Latin_Small_Letter_E",e[e.U_Combining_Latin_Small_Letter_I=869]="U_Combining_Latin_Small_Letter_I",e[e.U_Combining_Latin_Small_Letter_O=870]="U_Combining_Latin_Small_Letter_O",e[e.U_Combining_Latin_Small_Letter_U=871]="U_Combining_Latin_Small_Letter_U",e[e.U_Combining_Latin_Small_Letter_C=872]="U_Combining_Latin_Small_Letter_C",e[e.U_Combining_Latin_Small_Letter_D=873]="U_Combining_Latin_Small_Letter_D",e[e.U_Combining_Latin_Small_Letter_H=874]="U_Combining_Latin_Small_Letter_H",e[e.U_Combining_Latin_Small_Letter_M=875]="U_Combining_Latin_Small_Letter_M",e[e.U_Combining_Latin_Small_Letter_R=876]="U_Combining_Latin_Small_Letter_R",e[e.U_Combining_Latin_Small_Letter_T=877]="U_Combining_Latin_Small_Letter_T",e[e.U_Combining_Latin_Small_Letter_V=878]="U_Combining_Latin_Small_Letter_V",e[e.U_Combining_Latin_Small_Letter_X=879]="U_Combining_Latin_Small_Letter_X",e[e.LINE_SEPARATOR=8232]="LINE_SEPARATOR",e[e.PARAGRAPH_SEPARATOR=8233]="PARAGRAPH_SEPARATOR",e[e.NEXT_LINE=133]="NEXT_LINE",e[e.U_CIRCUMFLEX=94]="U_CIRCUMFLEX",e[e.U_GRAVE_ACCENT=96]="U_GRAVE_ACCENT",e[e.U_DIAERESIS=168]="U_DIAERESIS",e[e.U_MACRON=175]="U_MACRON",e[e.U_ACUTE_ACCENT=180]="U_ACUTE_ACCENT",e[e.U_CEDILLA=184]="U_CEDILLA",e[e.U_MODIFIER_LETTER_LEFT_ARROWHEAD=706]="U_MODIFIER_LETTER_LEFT_ARROWHEAD",e[e.U_MODIFIER_LETTER_RIGHT_ARROWHEAD=707]="U_MODIFIER_LETTER_RIGHT_ARROWHEAD",e[e.U_MODIFIER_LETTER_UP_ARROWHEAD=708]="U_MODIFIER_LETTER_UP_ARROWHEAD",e[e.U_MODIFIER_LETTER_DOWN_ARROWHEAD=709]="U_MODIFIER_LETTER_DOWN_ARROWHEAD",e[e.U_MODIFIER_LETTER_CENTRED_RIGHT_HALF_RING=722]="U_MODIFIER_LETTER_CENTRED_RIGHT_HALF_RING",e[e.U_MODIFIER_LETTER_CENTRED_LEFT_HALF_RING=723]="U_MODIFIER_LETTER_CENTRED_LEFT_HALF_RING",e[e.U_MODIFIER_LETTER_UP_TACK=724]="U_MODIFIER_LETTER_UP_TACK",e[e.U_MODIFIER_LETTER_DOWN_TACK=725]="U_MODIFIER_LETTER_DOWN_TACK",e[e.U_MODIFIER_LETTER_PLUS_SIGN=726]="U_MODIFIER_LETTER_PLUS_SIGN",e[e.U_MODIFIER_LETTER_MINUS_SIGN=727]="U_MODIFIER_LETTER_MINUS_SIGN",e[e.U_BREVE=728]="U_BREVE",e[e.U_DOT_ABOVE=729]="U_DOT_ABOVE",e[e.U_RING_ABOVE=730]="U_RING_ABOVE",e[e.U_OGONEK=731]="U_OGONEK",e[e.U_SMALL_TILDE=732]="U_SMALL_TILDE",e[e.U_DOUBLE_ACUTE_ACCENT=733]="U_DOUBLE_ACUTE_ACCENT",e[e.U_MODIFIER_LETTER_RHOTIC_HOOK=734]="U_MODIFIER_LETTER_RHOTIC_HOOK",e[e.U_MODIFIER_LETTER_CROSS_ACCENT=735]="U_MODIFIER_LETTER_CROSS_ACCENT",e[e.U_MODIFIER_LETTER_EXTRA_HIGH_TONE_BAR=741]="U_MODIFIER_LETTER_EXTRA_HIGH_TONE_BAR",e[e.U_MODIFIER_LETTER_HIGH_TONE_BAR=742]="U_MODIFIER_LETTER_HIGH_TONE_BAR",e[e.U_MODIFIER_LETTER_MID_TONE_BAR=743]="U_MODIFIER_LETTER_MID_TONE_BAR",e[e.U_MODIFIER_LETTER_LOW_TONE_BAR=744]="U_MODIFIER_LETTER_LOW_TONE_BAR",e[e.U_MODIFIER_LETTER_EXTRA_LOW_TONE_BAR=745]="U_MODIFIER_LETTER_EXTRA_LOW_TONE_BAR",e[e.U_MODIFIER_LETTER_YIN_DEPARTING_TONE_MARK=746]="U_MODIFIER_LETTER_YIN_DEPARTING_TONE_MARK",e[e.U_MODIFIER_LETTER_YANG_DEPARTING_TONE_MARK=747]="U_MODIFIER_LETTER_YANG_DEPARTING_TONE_MARK",e[e.U_MODIFIER_LETTER_UNASPIRATED=749]="U_MODIFIER_LETTER_UNASPIRATED",e[e.U_MODIFIER_LETTER_LOW_DOWN_ARROWHEAD=751]="U_MODIFIER_LETTER_LOW_DOWN_ARROWHEAD",e[e.U_MODIFIER_LETTER_LOW_UP_ARROWHEAD=752]="U_MODIFIER_LETTER_LOW_UP_ARROWHEAD",e[e.U_MODIFIER_LETTER_LOW_LEFT_ARROWHEAD=753]="U_MODIFIER_LETTER_LOW_LEFT_ARROWHEAD",e[e.U_MODIFIER_LETTER_LOW_RIGHT_ARROWHEAD=754]="U_MODIFIER_LETTER_LOW_RIGHT_ARROWHEAD",e[e.U_MODIFIER_LETTER_LOW_RING=755]="U_MODIFIER_LETTER_LOW_RING",e[e.U_MODIFIER_LETTER_MIDDLE_GRAVE_ACCENT=756]="U_MODIFIER_LETTER_MIDDLE_GRAVE_ACCENT",e[e.U_MODIFIER_LETTER_MIDDLE_DOUBLE_GRAVE_ACCENT=757]="U_MODIFIER_LETTER_MIDDLE_DOUBLE_GRAVE_ACCENT",e[e.U_MODIFIER_LETTER_MIDDLE_DOUBLE_ACUTE_ACCENT=758]="U_MODIFIER_LETTER_MIDDLE_DOUBLE_ACUTE_ACCENT",e[e.U_MODIFIER_LETTER_LOW_TILDE=759]="U_MODIFIER_LETTER_LOW_TILDE",e[e.U_MODIFIER_LETTER_RAISED_COLON=760]="U_MODIFIER_LETTER_RAISED_COLON",e[e.U_MODIFIER_LETTER_BEGIN_HIGH_TONE=761]="U_MODIFIER_LETTER_BEGIN_HIGH_TONE",e[e.U_MODIFIER_LETTER_END_HIGH_TONE=762]="U_MODIFIER_LETTER_END_HIGH_TONE",e[e.U_MODIFIER_LETTER_BEGIN_LOW_TONE=763]="U_MODIFIER_LETTER_BEGIN_LOW_TONE",e[e.U_MODIFIER_LETTER_END_LOW_TONE=764]="U_MODIFIER_LETTER_END_LOW_TONE",e[e.U_MODIFIER_LETTER_SHELF=765]="U_MODIFIER_LETTER_SHELF",e[e.U_MODIFIER_LETTER_OPEN_SHELF=766]="U_MODIFIER_LETTER_OPEN_SHELF",e[e.U_MODIFIER_LETTER_LOW_LEFT_ARROW=767]="U_MODIFIER_LETTER_LOW_LEFT_ARROW",e[e.U_GREEK_LOWER_NUMERAL_SIGN=885]="U_GREEK_LOWER_NUMERAL_SIGN",e[e.U_GREEK_TONOS=900]="U_GREEK_TONOS",e[e.U_GREEK_DIALYTIKA_TONOS=901]="U_GREEK_DIALYTIKA_TONOS",e[e.U_GREEK_KORONIS=8125]="U_GREEK_KORONIS",e[e.U_GREEK_PSILI=8127]="U_GREEK_PSILI",e[e.U_GREEK_PERISPOMENI=8128]="U_GREEK_PERISPOMENI",e[e.U_GREEK_DIALYTIKA_AND_PERISPOMENI=8129]="U_GREEK_DIALYTIKA_AND_PERISPOMENI",e[e.U_GREEK_PSILI_AND_VARIA=8141]="U_GREEK_PSILI_AND_VARIA",e[e.U_GREEK_PSILI_AND_OXIA=8142]="U_GREEK_PSILI_AND_OXIA",e[e.U_GREEK_PSILI_AND_PERISPOMENI=8143]="U_GREEK_PSILI_AND_PERISPOMENI",e[e.U_GREEK_DASIA_AND_VARIA=8157]="U_GREEK_DASIA_AND_VARIA",e[e.U_GREEK_DASIA_AND_OXIA=8158]="U_GREEK_DASIA_AND_OXIA",e[e.U_GREEK_DASIA_AND_PERISPOMENI=8159]="U_GREEK_DASIA_AND_PERISPOMENI",e[e.U_GREEK_DIALYTIKA_AND_VARIA=8173]="U_GREEK_DIALYTIKA_AND_VARIA",e[e.U_GREEK_DIALYTIKA_AND_OXIA=8174]="U_GREEK_DIALYTIKA_AND_OXIA",e[e.U_GREEK_VARIA=8175]="U_GREEK_VARIA",e[e.U_GREEK_OXIA=8189]="U_GREEK_OXIA",e[e.U_GREEK_DASIA=8190]="U_GREEK_DASIA",e[e.U_OVERLINE=8254]="U_OVERLINE",e[e.UTF8_BOM=65279]="UTF8_BOM",e))(Le||{});function Fe(e){return e>=Le.A&&e<=Le.Z}var Lt=Object.defineProperty,Tt=Object.getOwnPropertyDescriptor,vt=(e,t,n,i)=>{for(var s=i>1?void 0:i?Tt(t,n):t,_=e.length-1,r;_>=0;_--)(r=e[_])&&(s=(i?r(t,n,s):r(s))||s);return i&&s&&Lt(t,n,s),s};function Z(e){switch(e){case 100:return"req";case 101:return"cancel";case 102:return"subscribe";case 103:return"unsubscribe"}}function ue(e){switch(e){case 200:return"init";case 201:return"reply:";case 202:case 203:return"replyErr:";case 204:return"event:"}}class It{constructor(t,n,i=null,s=1e3){l(this,"channels",new Map);l(this,"activeRequests",new Map);l(this,"protocolListener");l(this,"pendingRequests",new Map);this.protocol=t,this.ctx=n,this.logger=i,this.timeoutDelay=s,this.protocolListener=this.protocol.onMessage(_=>this.onRawMessage(_)),this.sendResponse({type:200})}registerChannel(t,n){this.channels.set(t,n),setTimeout(()=>this.flushPendingRequests(t),0)}sendResponse(t){var n,i;switch(t.type){case 200:{this.send([t.type]),(n=this.logger)==null||n.logOutgoing(0,K.OtherSide,ue(t.type));return}case 201:case 202:case 204:case 203:{this.send([t.type,t.id],t.data),(i=this.logger)==null||i.logOutgoing(t.id,K.OtherSide,ue(t.type),t.data);return}}}send(t,n){try{return this.protocol.send({head:t,body:n}),1}catch{return 0}}onRawMessage(t){var _,r,u,f;const n=t.head,i=t.body,s=n[0];switch(s){case 100:return(_=this.logger)==null||_.logIncoming(n[1],K.OtherSide,`${Z(s)}: ${n[2]}.${n[3]}`,i),this.onPromise({type:s,id:n[1],channelName:n[2],name:n[3],arg:i});case 102:return(r=this.logger)==null||r.logIncoming(n[1],K.OtherSide,`${Z(s)}: ${n[2]}.${n[3]}`,i),this.onEventListen({type:s,id:n[1],channelName:n[2],name:n[3],arg:i});case 101:return(u=this.logger)==null||u.logIncoming(n[1],K.OtherSide,`${Z(s)}`),this.disposeActiveRequest({type:s,id:n[1]});case 103:return(f=this.logger)==null||f.logIncoming(n[1],K.OtherSide,`${Z(s)}`),this.disposeActiveRequest({type:s,id:n[1]})}}onPromise(t){const n=this.channels.get(t.channelName);if(!n){this.collectPendingRequest(t);return}const i=new Ve;let s;try{s=n.call(this.ctx,t.name,t.arg,i.token)}catch(u){s=Promise.reject(u)}const _=t.id;s.then(u=>{this.sendResponse({id:_,data:u,type:201}),this.activeRequests.delete(t.id)},u=>{u instanceof Error?this.sendResponse({id:_,data:{message:u.message,name:u.name,stack:u.stack?u.stack.split?u.stack.split(`
`):u.stack:void 0},type:202}):this.sendResponse({id:_,data:u,type:203}),this.activeRequests.delete(t.id)});const r=ge(()=>i.cancel());this.activeRequests.set(t.id,r)}onEventListen(t){const n=this.channels.get(t.channelName);if(!n){this.collectPendingRequest(t);return}const i=t.id,_=n.listen(this.ctx,t.name,t.arg)(r=>this.sendResponse({id:i,data:r,type:204}));this.activeRequests.set(t.id,_)}disposeActiveRequest(t){const n=this.activeRequests.get(t.id);n&&(n.dispose(),this.activeRequests.delete(t.id))}collectPendingRequest(t){let n=this.pendingRequests.get(t.channelName);n||(n=[],this.pendingRequests.set(t.channelName,n));const i=setTimeout(()=>{console.error(`Unknown channel: ${t.channelName}`),t.type===100&&this.sendResponse({id:t.id,data:{name:"Unknown channel",message:`Channel name '${t.channelName}' timed out after ${this.timeoutDelay}ms`,stack:void 0},type:202})},this.timeoutDelay);n.push({request:t,timeoutTimer:i})}flushPendingRequests(t){const n=this.pendingRequests.get(t);if(n){for(const i of n)switch(clearTimeout(i.timeoutTimer),i.request.type){case 100:this.onPromise(i.request);break;case 102:this.onEventListen(i.request);break}this.pendingRequests.delete(t)}}dispose(){this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),me(this.activeRequests.values()),this.activeRequests.clear()}}var K=(e=>(e[e.LocalSide=0]="LocalSide",e[e.OtherSide=1]="OtherSide",e))(K||{});class je{constructor(t,n=null){l(this,"isDisposed",!1);l(this,"state",0);l(this,"activeRequests",new Set);l(this,"handlers",new Map);l(this,"lastRequestId",0);l(this,"protocolListener");l(this,"logger");l(this,"_onDidInitialize",new P);l(this,"onDidInitialize",this._onDidInitialize.event);this.protocol=t,this.protocolListener=this.protocol.onMessage(i=>this.onMessage(i)),this.logger=n}getChannel(t){const n=this;return{call(i,s,_){return n.isDisposed?Promise.reject(new J):n.requestPromise(t,i,s,_)},listen(i,s){return n.isDisposed?y.None:n.requestEvent(t,i,s)}}}requestPromise(t,n,i,s=ee.None){const _=this.lastRequestId++,u={id:_,type:100,channelName:t,name:n,arg:i};if(s.isCancellationRequested)return Promise.reject(new J);let f;return new Promise((o,c)=>{if(s.isCancellationRequested)return c(new J);const m=()=>{const O=h=>{switch(h.type){case 201:this.handlers.delete(_),o(h.data);break;case 202:{this.handlers.delete(_);const p=new Error(h.data.message);p.stack=Array.isArray(h.data.stack)?h.data.stack.join(`
`):h.data.stack,p.name=h.data.name,c(p);break}case 203:this.handlers.delete(_),c(h.data);break}};this.handlers.set(_,O),this.sendRequest(u)};let A=null;this.state===1?m():(A=ye(O=>this.whenInitialized()),A.then(()=>{A=null,m()}));const S=()=>{A?(A.cancel(),A=null):this.sendRequest({id:_,type:101}),c(new J)},w=s.onCancellationRequested(S);f=qe(ge(S),w),this.activeRequests.add(f)}).finally(()=>{this.activeRequests.delete(f)})}requestEvent(t,n,i){const s=this.lastRequestId++,r={id:s,type:102,channelName:t,name:n,arg:i};let u=null;const f=new P({onWillAddFirstListener:()=>{u=ye(o=>this.whenInitialized()),u.then(()=>{u=null,this.activeRequests.add(f),this.sendRequest(r)})},onDidRemoveLastListener:()=>{u?(u.cancel(),u=null):(this.activeRequests.delete(f),this.sendRequest({id:s,type:103}))}}),b=o=>f.fire(o.data);return this.handlers.set(s,b),f.event}sendRequest(t){var n,i;switch(t.type){case 100:case 102:{this.send([t.type,t.id,t.channelName,t.name],t.arg),(n=this.logger)==null||n.logOutgoing(t.id,0,`${Z(t.type)}: ${t.channelName}.${t.name}`,t.arg);return}case 101:case 103:{this.send([t.type,t.id]),(i=this.logger)==null||i.logOutgoing(t.id,0,Z(t.type));return}}}send(t,n){try{return this.protocol.send({head:t,body:n}),1}catch{return 0}}onMessage(t){var _,r;const n=t.head,i=t.body,s=n[0];switch(s){case 200:return(_=this.logger)==null||_.logIncoming(0,0,ue(s)),this.onResponse({type:n[0]});case 201:case 202:case 204:case 203:return(r=this.logger)==null||r.logIncoming(n[1],0,ue(s),i),this.onResponse({type:n[0],id:n[1],data:i})}}onResponse(t){if(t.type===200){this.state=1,this._onDidInitialize.fire();return}const n=this.handlers.get(t.id);n==null||n(t)}get onDidInitializePromise(){return y.toPromise(this.onDidInitialize)}whenInitialized(){return this.state===1?Promise.resolve():this.onDidInitializePromise}dispose(){this.isDisposed=!0,this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),me(this.activeRequests.values()),this.activeRequests.clear()}}vt([At],je.prototype,"onDidInitializePromise",1);class wt{constructor(t,n,i=null){l(this,"channelClient");l(this,"channelServer");this.channelClient=new je(t,i),this.channelServer=new It(t,n,i)}getChannel(t){return this.channelClient.getChannel(t)}registerChannel(t,n){this.channelServer.registerChannel(t,n)}dispose(){this.channelClient.dispose(),this.channelServer.dispose()}}function Dt(e){return{call(t,n,i){return e.then(s=>s.call(t,n,i))},listen(t,n){const i=new Ut;return e.then(s=>i.input=s.listen(t,n)),i.event}}}var Ne;(e=>{function t(_,r){const u=_,f=r&&r.disableMarshalling,b=new Map;for(const o in u)i(o)&&b.set(o,y.buffer(u[o],!0));return new class{listen(o,c,m){const A=b.get(c);if(A)return A;if(s(c)){const S=u[c];if(typeof S=="function")return S.call(u,m)}throw new Error(`Event not found: ${c}`)}call(o,c,m){const A=u[c];if(typeof A=="function")return!f&&Array.isArray(m)&&Me(),A.apply(u,m);throw new Error(`Method not found: ${c}`)}}}e.fromService=t;function n(_,r){const u=r&&r.disableMarshalling;return new Proxy({},{get(f,b){var o;if(typeof b=="string")return(o=r==null?void 0:r.properties)!=null&&o.has(b)?r.properties.get(b):s(b)?function(c){return _.listen(b,c)}:i(b)?_.listen(b):async function(...c){let m;r&&!nt(r.context)?m=[r.context,...c]:m=c;const A=await _.call(b,m);return u||Me(),A};throw new Error(`Property not found: ${String(b)}`)}})}e.toService=n;function i(_){return _[0]==="o"&&_[1]==="n"&&Fe(_.charCodeAt(2))}function s(_){return/^onDynamic/.test(_)&&Fe(_.charCodeAt(9))}})(Ne||(Ne={}));class ht{constructor(t){l(this,"onMessage");this.port=t,t.start(),this.onMessage=y.fromDOMEventEmitter(this.port,"message",n=>n.data)}send(t){this.port.postMessage(t)}disconnect(){this.port.close()}}class dt extends wt{constructor(n,i){const s=new ht(n);super(s,i);l(this,"protocol");this.protocol=s}dispose(){this.protocol.disconnect()}}class Ot extends dt{constructor(t,n){super(t,n)}}var Y=(e=>(e.createMessageChannel="createMessageChannel",e.createMessageChannelResult="createMessageChannelResult",e.transferMessageChannelResult="transferMessageChannelResult",e))(Y||{});const M=2,Te=80*M,Xe=48*M,ke=3*M,Be=2*M,j=3*M,q=15*M,X=74*M,Q=30*M,se=Math.round;function Pe(e){e.width=Te,e.height=Xe,Object.assign(e.style,{width:"80px",height:"48px",pointerEvents:"none"})}function Ge(){return(performance||Date).now()}const de=class{constructor(t){l(this,"id",de.ID++);l(this,"min",1/0);l(this,"max",0);l(this,"frames",0);l(this,"prevTime",0);l(this,"name","FPS");l(this,"fg","#0ff");l(this,"bg","#002");l(this,"context");this.canvas=t;const n=t.getContext("2d");this.context=n;const{name:i,bg:s,fg:_}=this;n.font="bold "+9*M+"px Helvetica,Arial,sans-serif",n.textBaseline="top",n.fillStyle=s,n.fillRect(0,0,Te,Xe),n.fillStyle=_,n.fillText(i,ke,Be),n.fillRect(j,q,X,Q),n.fillStyle=s,n.globalAlpha=.9,n.fillRect(j,q,X,Q)}begin(){this.prevTime=Ge()}update(){this.frames+=1;var t=Ge();t>=this.prevTime+1e3&&(this._update(this.frames*1e3/(t-this.prevTime),100),this.prevTime=t,this.frames=0)}_update(t,n){let{name:i,fg:s,bg:_,context:r,canvas:u}=this;this.min=Math.min(this.min,t),this.max=Math.max(this.max,t),r.fillStyle=_,r.globalAlpha=1,r.fillRect(0,0,Te,q),r.fillStyle=s,r.fillText(se(t)+" "+i+" ("+se(this.min)+"-"+se(this.max)+")",ke,Be),r.drawImage(u,j+M,q,X-M,Q,j,q,X-M,Q),r.fillRect(j+X-M,q,M,Q),r.fillStyle=_,r.globalAlpha=.9,r.fillRect(j+X-M,q,M,se((1-t/n)*Q))}};let ce=de;l(ce,"ID",0);class yt{constructor(t){l(this,"onUpdate");l(this,"onTick");this.channel=t,this.onUpdate=this.channel.listen("onUpdate"),this.onTick=this.channel.listen("onTick")}echo(){return this.channel.call("echo")}getParticles(){return this.channel.call("getParticles")}load(t){return this.channel.call("load",t)}}class St{constructor(t){l(this,"onUpdate");this.channel=t,this.onUpdate=this.channel.listen("onUpdate")}echo(){return this.channel.call("echo")}render(t){return this.channel.call("render",t)}toggleLongTask(){return this.channel.call("toggleLongTask")}}function Mt(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}async function Ft(e,t,n,i,s){let _;s==null||s.begin();const r=u=>{const f=u.length;e.clearRect(0,0,n,i),e.globalCompositeOperation="lighter";for(var b=0;b<f;b++){for(var o=u[b],c=1,m=0;m<f;m++){var A=u[m];e.lineWidth=.5,o.rgba==A.rgba&&Mt(o,A)<50&&(e.strokeStyle=o.rgba,e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(A.x,A.y),e.stroke(),c++)}e.fillStyle=o.rgba,e.strokeStyle=o.rgba,e.beginPath(),e.arc(o.x,o.y,o.rad*c,0,Math.PI*2,!0),e.fill(),e.closePath(),e.beginPath(),e.arc(o.x,o.y,(o.rad+5)*c,0,Math.PI*2,!0),e.stroke(),e.closePath()}s==null||s.update()};t.onTick(u=>{_&&cancelAnimationFrame(_),_=requestAnimationFrame(()=>r(u))})}function Nt(){return new Worker(""+new URL("model.ba0cc384.js",import.meta.url).href)}function kt(){return new Worker(""+new URL("render.df3b5080.js",import.meta.url).href)}var ve={exports:{}},pe,He;function Bt(){if(He)return pe;He=1;var e=1e3,t=e*60,n=t*60,i=n*24,s=i*7,_=i*365.25;pe=function(o,c){c=c||{};var m=typeof o;if(m==="string"&&o.length>0)return r(o);if(m==="number"&&isFinite(o))return c.long?f(o):u(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))};function r(o){if(o=String(o),!(o.length>100)){var c=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(!!c){var m=parseFloat(c[1]),A=(c[2]||"ms").toLowerCase();switch(A){case"years":case"year":case"yrs":case"yr":case"y":return m*_;case"weeks":case"week":case"w":return m*s;case"days":case"day":case"d":return m*i;case"hours":case"hour":case"hrs":case"hr":case"h":return m*n;case"minutes":case"minute":case"mins":case"min":case"m":return m*t;case"seconds":case"second":case"secs":case"sec":case"s":return m*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return m;default:return}}}}function u(o){var c=Math.abs(o);return c>=i?Math.round(o/i)+"d":c>=n?Math.round(o/n)+"h":c>=t?Math.round(o/t)+"m":c>=e?Math.round(o/e)+"s":o+"ms"}function f(o){var c=Math.abs(o);return c>=i?b(o,c,i,"day"):c>=n?b(o,c,n,"hour"):c>=t?b(o,c,t,"minute"):c>=e?b(o,c,e,"second"):o+" ms"}function b(o,c,m,A){var S=c>=m*1.5;return Math.round(o/m)+" "+A+(S?"s":"")}return pe}function Pt(e){n.debug=n,n.default=n,n.coerce=f,n.disable=_,n.enable=s,n.enabled=r,n.humanize=Bt(),n.destroy=b,Object.keys(e).forEach(o=>{n[o]=e[o]}),n.names=[],n.skips=[],n.formatters={};function t(o){let c=0;for(let m=0;m<o.length;m++)c=(c<<5)-c+o.charCodeAt(m),c|=0;return n.colors[Math.abs(c)%n.colors.length]}n.selectColor=t;function n(o){let c,m=null,A,S;function w(...O){if(!w.enabled)return;const h=w,p=Number(new Date),v=p-(c||p);h.diff=v,h.prev=c,h.curr=p,c=p,O[0]=n.coerce(O[0]),typeof O[0]!="string"&&O.unshift("%O");let L=0;O[0]=O[0].replace(/%([a-zA-Z%])/g,(E,a)=>{if(E==="%%")return"%";L++;const g=n.formatters[a];if(typeof g=="function"){const R=O[L];E=g.call(h,R),O.splice(L,1),L--}return E}),n.formatArgs.call(h,O),(h.log||n.log).apply(h,O)}return w.namespace=o,w.useColors=n.useColors(),w.color=n.selectColor(o),w.extend=i,w.destroy=n.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(A!==n.namespaces&&(A=n.namespaces,S=n.enabled(o)),S),set:O=>{m=O}}),typeof n.init=="function"&&n.init(w),w}function i(o,c){const m=n(this.namespace+(typeof c>"u"?":":c)+o);return m.log=this.log,m}function s(o){n.save(o),n.namespaces=o,n.names=[],n.skips=[];let c;const m=(typeof o=="string"?o:"").split(/[\s,]+/),A=m.length;for(c=0;c<A;c++)!m[c]||(o=m[c].replace(/\*/g,".*?"),o[0]==="-"?n.skips.push(new RegExp("^"+o.slice(1)+"$")):n.names.push(new RegExp("^"+o+"$")))}function _(){const o=[...n.names.map(u),...n.skips.map(u).map(c=>"-"+c)].join(",");return n.enable(""),o}function r(o){if(o[o.length-1]==="*")return!0;let c,m;for(c=0,m=n.skips.length;c<m;c++)if(n.skips[c].test(o))return!1;for(c=0,m=n.names.length;c<m;c++)if(n.names[c].test(o))return!0;return!1}function u(o){return o.toString().substring(2,o.toString().length-2).replace(/\.\*\?$/,"*")}function f(o){return o instanceof Error?o.stack||o.message:o}function b(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Gt=Pt;(function(e,t){t.formatArgs=i,t.save=s,t.load=_,t.useColors=n,t.storage=r(),t.destroy=(()=>{let f=!1;return()=>{f||(f=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(f){if(f[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+f[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const b="color: "+this.color;f.splice(1,0,b,"color: inherit");let o=0,c=0;f[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(o++,m==="%c"&&(c=o))}),f.splice(c,0,b)}t.log=console.debug||console.log||(()=>{});function s(f){try{f?t.storage.setItem("debug",f):t.storage.removeItem("debug")}catch{}}function _(){let f;try{f=t.storage.getItem("debug")}catch{}return!f&&typeof process<"u"&&"env"in process&&(f=process.env.DEBUG),f}function r(){try{return localStorage}catch{}}e.exports=Gt(t);const{formatters:u}=e.exports;u.j=function(f){try{return JSON.stringify(f)}catch(b){return"[UnexpectedJSONParseError]: "+b.message}}})(ve,ve.exports);const Ht=ve.exports;Ht("editor:ma");class xt{constructor(){l(this,"model");l(this,"render");l(this,"withModelConnection");l(this,"withRenderConnection");l(this,"modelService");l(this,"renderService");l(this,"mainCanvas");l(this,"panel");l(this,"runningLongTask");this.model=new Nt,this.render=new kt,this.withModelConnection=this.connect(this.model,"main2model"),this.withRenderConnection=this.connect(this.render,"main2render"),this.modelService=new yt(this.getChannel(this.withModelConnection,"model")),this.renderService=new St(this.getChannel(this.withRenderConnection,"render"));const t=document.querySelector("#mainCanvas"),n=document.querySelector("#renderCanvas"),i=n.getBoundingClientRect();n.width=i.width,n.height=i.height,t.width=i.width,t.height=i.height,Object.assign(n.style,{width:i.width+"px",height:i.height+"px"}),Object.assign(t.style,{width:i.width+"px",height:i.height+"px"});const s=document.querySelector("#mainStat"),_=document.querySelector("#renderStat");Pe(s),Pe(_),this.panel=new ce(s);const r=n.transferControlToOffscreen(),u=_.transferControlToOffscreen();this.render.postMessage({canvas:r,stat:u},[r,u]),this.mainCanvas=t,this.init();const f=document.querySelector("#ltMain"),b=document.querySelector("#ltRender");f.addEventListener("change",()=>{this.toggleLongTask()}),this.toggleLongTask(),b.addEventListener("change",()=>{this.renderService.toggleLongTask()})}async init(){await this.connectModelAndRender(),await this.modelService.load({w:this.mainCanvas.width,h:this.mainCanvas.height}),this.start()}async connect(t,n){t.postMessage({command:Y.createMessageChannel,arg:n});const i=y.fromDOMEventEmitter(t,"message"),s=await y.toPromise(y.once(y.filter(i,_=>{const{data:r}=_;return r.command&&r.command===Y.createMessageChannelResult&&r.arg===n})));return new Ot(s.ports[0],n)}async connectModelAndRender(){return new Promise(async t=>{const n="model2worker";this.model.postMessage({command:Y.createMessageChannel,arg:n});const i=y.fromDOMEventEmitter(this.model,"message"),s=y.filter(y.fromDOMEventEmitter(this.render,"message"),u=>{const{data:f}=u;return f.command&&f.command===Y.transferMessageChannelResult}),r=(await y.toPromise(y.once(y.filter(i,u=>{const{data:f}=u;return f.command&&f.command===Y.createMessageChannelResult&&f.arg===n})))).ports[0];this.render.postMessage({port:r,channelName:n},{transfer:[r]}),y.once(s)(()=>t())})}getChannel(t,n){return Dt(t.then(i=>i.getChannel(n)))}async start(){this.renderService.render({width:this.mainCanvas.width,height:this.mainCanvas.height}),Ft(this.mainCanvas.getContext("2d"),this.modelService,this.mainCanvas.width,this.mainCanvas.height,this.panel)}toggleLongTask(){if(this.runningLongTask)cancelAnimationFrame(this.runningLongTask),this.runningLongTask=void 0;else{const t=()=>{const n=Wt();Reflect.set(window,"test",n),this.runningLongTask=requestAnimationFrame(t)};t()}}}function Wt(){let e=1;for(let t=0;t<2e8;t++)e+=t;return e}new xt;
